<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>SignalCliApi.signalCli API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../SignalCliApi.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;SignalCliApi</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SignalCli">SignalCli</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SignalCli.__init__">SignalCli</a>
                        </li>
                        <li>
                                <a class="variable" href="#SignalCli.config_path">config_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#SignalCli.accounts">accounts</a>
                        </li>
                        <li>
                                <a class="variable" href="#SignalCli.sticker_packs">sticker_packs</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.stop_signal">stop_signal</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.register_account">register_account</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.start_link">start_link</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.finish_link">finish_link</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.start_receive">start_receive</a>
                        </li>
                        <li>
                                <a class="function" href="#SignalCli.stop_receive">stop_receive</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Version 1.0</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../SignalCliApi.html">SignalCliApi</a><wbr>.signalCli    </h1>

                
                        <input id="mod-signalCli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-signalCli-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">socket</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">CalledProcessError</span><span class="p">,</span> <span class="n">check_output</span><span class="p">,</span> <span class="n">check_call</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">NoReturn</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">.signalAccount</span> <span class="kn">import</span> <span class="n">Account</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">.signalAccounts</span> <span class="kn">import</span> <span class="n">Accounts</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">.signalCommon</span> <span class="kn">import</span> <span class="n">__type_error__</span><span class="p">,</span> <span class="n">__find_signal__</span><span class="p">,</span> <span class="n">__find_qrencode__</span><span class="p">,</span> <span class="n">__parse_signal_return_code__</span><span class="p">,</span> <span class="n">__socket_create__</span><span class="p">,</span> \
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">__socket_connect__</span><span class="p">,</span> <span class="n">__socket_close__</span><span class="p">,</span> <span class="n">__socket_receive__</span><span class="p">,</span> <span class="n">__socket_send__</span><span class="p">,</span> <span class="n">phone_number_regex</span><span class="p">,</span> <span class="n">__type_err_msg__</span><span class="p">,</span> \
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="n">CallbackIdx</span><span class="p">,</span> <span class="n">__parse_signal_response__</span><span class="p">,</span> <span class="n">__check_response_for_error__</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">.signalReceiveThread</span> <span class="kn">import</span> <span class="n">ReceiveThread</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">.signalSticker</span> <span class="kn">import</span> <span class="n">StickerPacks</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">.signalExceptions</span> <span class="kn">import</span> <span class="n">LinkNotStarted</span><span class="p">,</span> <span class="n">LinkInProgress</span><span class="p">,</span> <span class="n">SignalError</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="k">class</span> <span class="nc">SignalCli</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Signal cli object.&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>                 <span class="n">signal_config_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>                 <span class="n">signal_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>                 <span class="n">server_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>                 <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>                 <span class="n">start_signal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>                 <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        Initialize signal-cli, starting the process if required.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        :param signal_config_path: Optional[str]: The path to the directory signal-cli should use.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        :param signal_exec_path: Optional[str]: The path to the signal-cli executable.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        :param server_address: Optional[list[str , int] | tuple[str, int] | str]: If signal-cli is already started,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">            the address of the server, if a unix socket, use a str, otherwise use a tuple/list[hostname:str,port:int]</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        :param log_file_path: Optional[str]: The path to the signal log file, if None, no logging is preformed.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        :param start_signal: Bool: True = start a signal-cli process, False = signal-cli is already running.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        :param callback: Optional[tuple[Callable, Optional[list[Any]]]]: The call back as a tuple, the first element</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">            being the callable, and the second element; If not None, is a list of any parameters to provide to the</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">            callback.  The callback signature is: (status: str, *params)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        :param debug: Bool: Produce debug output on stdout.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        :raises TypeError: If a parameter is of invalid type.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        :raises FileNotFoundError: If a file / directory doesn&#39;t exist when it should.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        :raises FileExistsError: If a socket file exists when it shouldn&#39;t.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        :raises RuntimeError: If an error occurs while loading signal data, more information in the error message.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="c1"># Super:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="nb">object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="c1"># Setup logging.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialize.&quot;</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="c1"># Check signal config path:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_config_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_config_path</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_config_path &#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t exist.&quot;</span> <span class="o">%</span> <span class="n">signal_config_path</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="c1"># Check signal exec path:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_exec_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_exec_path</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_exec_path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">signal_exec_path</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="c1"># Check start signal:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_signal</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;start_signal&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">start_signal</span><span class="p">)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="c1"># Check the server address:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;server_address must have a length of 2.&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising ValueError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[0]&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[1]&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; already exists. Perhaps signal is already running.&quot;</span> \
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileExistsError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist. Perhaps signal isn&#39;t running.&quot;</span> \
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileNotFoundError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;server_address&#39;</span><span class="p">,</span> <span class="s1">&#39;list[str, int] | tuple[str, int] | str&#39;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="c1"># Check the log file path:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">log_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;log_file_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">log_file_path</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="c1"># Check callback:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[tuple[Callable, Optional[list[Any]]]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;callback must be 2 elements long.&quot;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">]):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[0]&#39;</span><span class="p">,</span> <span class="s1">&#39;Callable&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">])</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="k">elif</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[1]&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[list[Any]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">])</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="c1"># Check debug:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="c1"># Set internal vars:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="c1"># Set the config path:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal config directory.&quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">signal_config_path</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">home_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_path</span><span class="p">,</span> <span class="s1">&#39;.local&#39;</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="s1">&#39;signal-cli&#39;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli config path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="c1"># Set signal exec path:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signalExecPath</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal-cli executable.&quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to passed parameter.&quot;</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">signal_exec_path</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">elif</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finding signal_exec_path.&quot;</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">__find_signal__</span><span class="p">()</span>  <span class="c1"># Raises FileNotFoundError if signal-cli not found.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to None.&quot;</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli exec path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="c1"># Set server address:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;The server address of the signal-cli socket.&quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting server_address from parameter.&quot;</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">server_address</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building server_address, selecting UNIX socket.&quot;</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Server address: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">))</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="c1"># Store debug:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if we should produce debugging output.&quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="c1"># Store log file path:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_file_path</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The path to the signal-cli log file.&quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="c1"># Store callback:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="n">callback</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The start up call back.&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="c1"># set var to hold the main signal process</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Popen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The main signal-cli process.&quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1"># Set sync socket:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform sync operations with.&quot;&quot;&quot;</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># Set command socket:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform command operations with.&quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="c1"># Set var to hold the link request:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The signal-cli request for linking a new account.&quot;&quot;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="c1"># Set qrencode exec path:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">__find_qrencode__</span><span class="p">()</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the qrencode executable.&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="c1"># Set external properties and objects:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="c1"># Set accounts:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Accounts</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># Set sticker packs:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StickerPacks</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="c1"># Start signal-cli if requested:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting signal-cli.&quot;</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;starting signal-cli&#39;</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">signal_command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_signal_command_line__</span><span class="p">()</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">CalledProcessError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_signal__</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="n">__parse_signal_return_code__</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">signal_command_line</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>  <span class="c1"># NoReturn</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli started&quot;</span><span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="c1"># Wait for the socket to appear:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;server_address is a socket, and we&#39;re starting signal, wait for socket to appear.&quot;</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;start waiting for socket&quot;</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_signal_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;socket found.&quot;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;socket found&#39;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="c1"># Create sockets and connect to them:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting to sockets.&quot;</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connecting to sockets&#39;</span><span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__connect_to_sockets__</span><span class="p">()</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connected to sockets.&quot;</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connected to sockets&#39;</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="c1"># Load stickers:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading sticker packs.&quot;</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span> <span class="o">=</span> <span class="n">StickerPacks</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="c1"># Load accounts:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading accounts.&quot;</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">Accounts</span><span class="p">(</span><span class="n">sync_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                                 <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span> <span class="n">do_load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="c1"># Create dict to hold processes:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReceiveThread</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The dict to store the receive threads.&quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialization complete.&quot;</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">return</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">__connect_to_sockets__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        Connect to and store the sockets.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        :return: None | NoReturn.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        :raises CommunicationsError: On error creating or connecting to a socket.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__connect_to_sockets__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span> <span class="o">=</span> <span class="n">__socket_create__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">__socket_connect__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connected to command socket.&quot;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span> <span class="o">=</span> <span class="n">__socket_create__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">__socket_connect__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connected to sync socket.&quot;</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">return</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">__close_sockets__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        Close and clear sockets.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        :return: None | NoReturn: None if all closed, NoReturn on error closing socket.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        :raises CommunicationError: On error closing socket.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__close_sockets__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">__socket_close__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sync socket closed.&quot;</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">__socket_close__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Command socket closed.&quot;</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="k">return</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">__wait_for_signal_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        Wait for the signal socket file to appear.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        :param socket_file_path: str: The full path to the socket file.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        :param timeout: float: The timeout in .5 second increments.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        :return: None</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        :raises TimeoutError on timeout.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_signal_socket_file__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">current_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">socket_file_path</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Waiting for socket...&quot;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;waiting for socket&#39;</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="n">current_time</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;timeout while waiting for signal to create socket.&quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TimeoutError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Give it a second to stabilize</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">return</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">__build_signal_command_line__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="c1"># Build signal-cli command line:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_signal_command_line__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">signal_command_line</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span><span class="p">]</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;--log-file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span><span class="p">])</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--config&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;daemon&#39;</span><span class="p">])</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--socket&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">])</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--tcp&#39;</span><span class="p">,</span> <span class="n">address</span><span class="p">])</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--no-receive-stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;--receive-mode&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">])</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Signal command line: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">))</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="n">signal_command_line</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">__start_signal__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        Start and store the signal-cli process.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        :param signal_command_line: list[str]: The command line to run.</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        :return: True | CalledProcessError: True if started, Called process error on exit-code &gt; 0.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="c1"># Log start:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_signal__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting signal-cli.&quot;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="c1"># Run signal-cli in daemon mode:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="k">except</span> <span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Failed to start signal-cli.&quot;</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;failed to start signal-cli&quot;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="k">return</span> <span class="n">e</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="c1"># Give signal 5 seconds to start</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;Waiting for signal-cli to initialize.&quot;</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;signal-cli initialized.&#39;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="c1">#################################</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="c1"># Internal methods:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="c1">#################################</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">__run_callback__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Callback not defined, skipping.&quot;</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">return</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="n">callback_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Running callback &#39;</span><span class="si">%s</span><span class="s2">&#39; with status: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callback_name</span><span class="p">,</span> <span class="n">status</span><span class="p">))</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">](</span><span class="n">status</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">])</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">](</span><span class="n">status</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; Exception while running callback: &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                           <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">callback_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Callback raised an exception: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="k">return</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">__remove_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        Remove the signal socket file.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        :return: bool: Returns True when the file is removed, False if it wasn&#39;t.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__remove_socket_file__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing old socket file.&quot;</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to remove old socket file: &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="c1">#################################</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="c1"># Overrides:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="c1">#################################</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="p">()</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error occurred during termination of signal-cli process.&quot;</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error strArgs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">return</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="c1">#################################</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="c1"># Methods:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="c1">#################################</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>    <span class="k">def</span> <span class="nf">stop_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        Stop the signal-cli process.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        :returns: None</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        :raises CommunicationsError: On error closing a socket.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="c1"># Close the sockets:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Closing sockets.&quot;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;closing sockets&quot;</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__close_sockets__</span><span class="p">()</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sockets closed.&quot;</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;sockets closed&quot;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="c1"># Terminate process:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping signal-cli.&quot;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;stopping signal-cli&quot;</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>  <span class="c1"># Kill the process (Sends SigTerm)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Flushing pipes.&quot;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>  <span class="c1"># Flush the pipes.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDOUT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDERR: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Clear the process.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped.&quot;</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped&quot;</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="c1"># Remove socket file:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__remove_socket_file__</span><span class="p">()</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="k">return</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="nf">register_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                         <span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                         <span class="n">captcha</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                         <span class="n">voice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">                Register a new account. NOTE: Subject to rate limiting.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">                :param number: str: The phone number to register.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">                :param captcha: str: The captcha from &#39;https://signalcaptchas.org/registration/generate.html&#39;, can</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">                                        include the &#39;signalcaptcha://&#39;.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">                :param voice: bool: True = Voice call verification, False = SMS verification.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">                :returns: tuple[bool, Account | str]: The first element (bool) is True for success or failure.  The</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">                                                        second element on success is the new Account object, which</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">                                                        will remain in an unregistered state until verify is called</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">                                                        with the verification code.  Upon failure, the second element</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">                                                        will contain a string with an error message.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">                :raises: TypeError: If number or captcha are not strings, or if voice is not a boolean.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="c1"># Log started:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_account</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Register started.&quot;</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="c1"># Type check arguments:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks.&quot;</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: number is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">captcha</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: captcha is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">captcha</span><span class="p">)))</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;captcha&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">captcha</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: voice is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;bool&#39;.&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">voice</span><span class="p">)))</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;voice&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">voice</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks passed.&quot;</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="c1"># Value Check arguments:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Value checks.&quot;</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">number_match</span> <span class="o">=</span> <span class="n">phone_number_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="k">if</span> <span class="n">number_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;number must be in format +nnnnnnnn....&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">if</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signalcaptcha://&#39;</span><span class="p">):</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stripping signalcaptcha:// from captcha.&quot;</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="n">captcha</span> <span class="o">=</span> <span class="n">captcha</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-recaptcha-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-hcaptcha&#39;</span><span class="p">):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid captcha.&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="c1"># Check if the account exists, and isn&#39;t registered.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">get_by_number</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">registered</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Account already registered.&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="c1"># Create register account command object and json command string:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="n">register_account_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>                <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>                <span class="s2">&quot;captcha&quot;</span><span class="p">:</span> <span class="n">captcha</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="s2">&quot;voice&quot;</span><span class="p">:</span> <span class="n">voice</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="p">}</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="p">}</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">register_account_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="c1"># TODO: Fix error checking:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="c1"># Check for error:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="c1"># Delete local account data, since signal-cli creates data for the account.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting incomplete account.&quot;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="n">delete_local_data_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;deleteLocalAccountData&quot;</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                    <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>                <span class="p">}</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="p">}</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">delete_local_data_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="c1"># Communicate with signal:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>  <span class="c1"># output unused, we don&#39;t care if it failed.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="c1"># TODO: Error check delete request response and at least warn about it.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delete account response: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response_str</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Signal error, code: </span><span class="si">%i</span><span class="s2">, message: </span><span class="si">%s</span><span class="s2">&quot;</span> \
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>                            <span class="o">%</span> <span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Raising SignalError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="k">raise</span> <span class="n">SignalError</span><span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="c1"># No error found, get the new account:</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Registration successful, syncing accounts with disk...&quot;</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Account registered. Don&#39;t forget to verify.&quot;</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>    <span class="k">def</span> <span class="nf">start_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>                   <span class="n">gen_text_qr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                   <span class="n">png_qr_code_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Start the link process for linking an existing account.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        :param gen_text_qr: bool: True, generate text qr-code, False, do not.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        :param png_qr_code_file_path: Optional[str]: The file path to generate the png qr code at, if None, the qr code</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">            is not generated.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        :returns: tuple[str, str, str]: The first element is the link url generated by signal.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">            The second element is a text QR code string, or an empty string if qrencode is not installed.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">            The third element is a path to a generated png qrencode, or an empty string if qrencode is not installed.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        :raises: TypeError: If name is not a string or None.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">        :raises: LinkInProgress: If a link is already in progress when start_link_account is called a second time and</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">            finish_link has not been called.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">        :raises InvalidServerResponse: If the signal link doesn&#39;t seem valid.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_link</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Staring link process...&quot;</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="c1"># Type checks:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gen_text_qr</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">))</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;png_qr_code_file_path&quot;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">))</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;png_qr_code_file_path&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="c1"># Check for a running link request:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkInProgressError().&quot;</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="k">raise</span> <span class="n">LinkInProgress</span><span class="p">()</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="c1"># Ensure sigal is running:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-clil not running&quot;</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="c1"># Create link request object:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="n">link_request_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;startLink&quot;</span><span class="p">,</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="p">}</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="c1"># Create json command string:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_request_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>        <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="c1"># Gather the link from response obj:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;deviceLinkUri&#39;</span><span class="p">]</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="c1"># Generate text qrcode:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="n">text_qr_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gen_text_qr</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>            <span class="n">command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--type=UTF8&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">]</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate UTF8 QR-Code...&quot;</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                <span class="n">bytes_text_qr_code</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">command_line</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                <span class="n">text_qr_code</span> <span class="o">=</span> <span class="n">bytes_text_qr_code</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF8&#39;</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;UTF8 QR-Code successfully created.&quot;</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate UTF8 QR-Code.&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="c1"># Generate png qrcode:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate png QR-Code...&quot;</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                <span class="n">check_call</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">])</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;png QR-Code successfully generated.&quot;</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate png QR-Code.&quot;</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="c1"># Linking started successfully:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Link process successfully started.&quot;</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span> <span class="n">text_qr_code</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>    <span class="k">def</span> <span class="nf">finish_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">        Finish the linking process after confirming the link on the primary device.</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">        :param device_name: Optional[str]: The device name to give this link.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        :returns: tuple[bool, Account | str]: The first element is a bool representing success or failure; The second</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">                                                element on success will be the new Account object, or on failure will be</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">                                                a string containing an error message.</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        :raises LinkNotStarted: If the link process hasn&#39;t been started yet.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">        :raises InvalidServerResponse: If the signal success code is not recognized.</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">logger_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_link</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finish link process started.&quot;</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="c1"># Type check name:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;device_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">))</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;device_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[str]&quot;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="c1"># Check for a link process:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkNotStarted().&quot;</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>            <span class="k">raise</span> <span class="n">LinkNotStarted</span><span class="p">()</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>        <span class="c1"># Check for running signal-cli:</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-cli not running&quot;</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>        <span class="c1"># Generate the finishLink command object:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>        <span class="n">link_finish_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;finishLink&quot;</span><span class="p">,</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>                <span class="s2">&quot;deviceLinkUri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>            <span class="p">}</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="p">}</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>            <span class="n">link_finish_command_obj</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;deviceName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>        <span class="c1"># Generate json command string:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_finish_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>  <span class="c1"># Raises Invalid server response</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="c1"># Check for error:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="n">error_occurred</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span> <span class="o">=</span> <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">error_occurred</span><span class="p">:</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>            <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># User already exists:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;user already exists&quot;</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>            <span class="k">elif</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>  <span class="c1"># Timeout</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Unhandled non-fatal error. Code </span><span class="si">%i</span><span class="s2">, Message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="c1"># Gather linked number from response:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>        <span class="n">linked_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Link successful for account: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">linked_number</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="c1"># Sync accounts and get the new account:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Syncing accounts with disk.&quot;</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">start_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>                      <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">,</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>                      <span class="n">all_messages_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>                      <span class="n">received_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>                      <span class="n">receipt_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>                      <span class="n">sync_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>                      <span class="n">typing_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>                      <span class="n">story_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>                      <span class="n">payment_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>                      <span class="n">reaction_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>                      <span class="n">call_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">        Start receiving messages for the given account.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">        NOTE: Callback signature is (account: Account, message: Message)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">        :param account: Account: The account to receive messages for.</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">        :param all_messages_callback: Optional[Callable]: Callback for all messages received.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">        :param received_message_callback: Optional[Callable]: Callback for received messages. (regular message)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">        :param receipt_message_callback: Optional[Callable]: Callback for receipt messages.</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">        :param sync_message_callback: Optional[Callable]: Callback for sync messages.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">        :param typing_message_callback: Optional[Callable]: Callback for typing messages.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">        :param story_message_callback: Optional[Callable]: Callback for story messages.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">        :param payment_message_callback: Optional[Callable]: Callback for payment messages.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="sd">        :param reaction_message_callback: Optional[Callable]: Callback for reaction messages.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">        :param call_message_callback: Optional[Callable]: Callback for incoming call messages.</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">        :returns: None</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">        :raises: TypeError: If the account is not an Account object, or if a callback is defined, but not callable.</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start receive started.&quot;</span><span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>        <span class="c1"># Argument checks NOTE: ReceiveThread type checks callbacks:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>        <span class="k">if</span> <span class="n">all_messages_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">all_messages_callback</span><span class="p">):</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">))</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>        <span class="k">if</span> <span class="n">received_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">received_message_callback</span><span class="p">):</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>                                             <span class="n">received_message_callback</span><span class="p">))</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">received_message_callback</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        <span class="k">if</span> <span class="n">receipt_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">receipt_message_callback</span><span class="p">):</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>                                             <span class="n">receipt_message_callback</span><span class="p">))</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">receipt_message_callback</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="n">sync_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">sync_message_callback</span><span class="p">):</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">))</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="n">typing_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">typing_message_callback</span><span class="p">):</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>                                             <span class="n">typing_message_callback</span><span class="p">))</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">typing_message_callback</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="n">story_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">story_message_callback</span><span class="p">):</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;story_message_callback&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[Callable]&quot;</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>                                             <span class="n">story_message_callback</span><span class="p">))</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;story_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">story_message_callback</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>        <span class="k">if</span> <span class="n">payment_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">payment_message_callback</span><span class="p">):</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>                                             <span class="n">payment_message_callback</span><span class="p">))</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">payment_message_callback</span><span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>        <span class="k">if</span> <span class="n">reaction_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">reaction_message_callback</span><span class="p">):</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>                                             <span class="n">reaction_message_callback</span><span class="p">))</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">reaction_message_callback</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>        <span class="k">if</span> <span class="n">call_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">call_message_callback</span><span class="p">):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;call_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">call_message_callback</span><span class="p">))</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>        <span class="c1"># Start receive:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">ReceiveThread</span><span class="p">(</span><span class="n">server_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>                               <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>                               <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>                               <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>                               <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>                               <span class="n">all_messages_callback</span><span class="o">=</span><span class="n">all_messages_callback</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>                               <span class="n">received_message_callback</span><span class="o">=</span><span class="n">received_message_callback</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>                               <span class="n">receipt_message_callback</span><span class="o">=</span><span class="n">receipt_message_callback</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>                               <span class="n">sync_message_callback</span><span class="o">=</span><span class="n">sync_message_callback</span><span class="p">,</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>                               <span class="n">typing_message_callback</span><span class="o">=</span><span class="n">typing_message_callback</span><span class="p">,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>                               <span class="n">story_message_callback</span><span class="o">=</span><span class="n">story_message_callback</span><span class="p">,</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>                               <span class="n">payment_message_callback</span><span class="o">=</span><span class="n">payment_message_callback</span><span class="p">,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>                               <span class="n">reaction_message_callback</span><span class="o">=</span><span class="n">reaction_message_callback</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>                               <span class="n">call_message_callback</span><span class="o">=</span><span class="n">call_message_callback</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>                               <span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thread</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>        <span class="k">return</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>    <span class="k">def</span> <span class="nf">stop_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">        Stop receiving messages for the given account.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a><span class="sd">        :param account: Account: The account to stop reception for.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="sd">        :returns: bool: True reception successfully stopped, False reception wasn&#39;t started.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">        :raises: TypeError: If the parameter account is not an Account object.</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping reception thread.&quot;</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching thread: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">thread_id</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread not started.&quot;</span><span class="p">)</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stopping thread...&quot;</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread stopped.&quot;</span><span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reception stopped.&quot;</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            </section>
                <section id="SignalCli">
                            <input id="SignalCli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SignalCli</span>:

                <label class="view-source-button" for="SignalCli-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli-22"><a href="#SignalCli-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">SignalCli</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="SignalCli-23"><a href="#SignalCli-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Signal cli object.&quot;&quot;&quot;</span>
</span><span id="SignalCli-24"><a href="#SignalCli-24"><span class="linenos"> 24</span></a>
</span><span id="SignalCli-25"><a href="#SignalCli-25"><span class="linenos"> 25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli-26"><a href="#SignalCli-26"><span class="linenos"> 26</span></a>                 <span class="n">signal_config_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-27"><a href="#SignalCli-27"><span class="linenos"> 27</span></a>                 <span class="n">signal_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-28"><a href="#SignalCli-28"><span class="linenos"> 28</span></a>                 <span class="n">server_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-29"><a href="#SignalCli-29"><span class="linenos"> 29</span></a>                 <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-30"><a href="#SignalCli-30"><span class="linenos"> 30</span></a>                 <span class="n">start_signal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SignalCli-31"><a href="#SignalCli-31"><span class="linenos"> 31</span></a>                 <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-32"><a href="#SignalCli-32"><span class="linenos"> 32</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SignalCli-33"><a href="#SignalCli-33"><span class="linenos"> 33</span></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-34"><a href="#SignalCli-34"><span class="linenos"> 34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-35"><a href="#SignalCli-35"><span class="linenos"> 35</span></a><span class="sd">        Initialize signal-cli, starting the process if required.</span>
</span><span id="SignalCli-36"><a href="#SignalCli-36"><span class="linenos"> 36</span></a><span class="sd">        :param signal_config_path: Optional[str]: The path to the directory signal-cli should use.</span>
</span><span id="SignalCli-37"><a href="#SignalCli-37"><span class="linenos"> 37</span></a><span class="sd">        :param signal_exec_path: Optional[str]: The path to the signal-cli executable.</span>
</span><span id="SignalCli-38"><a href="#SignalCli-38"><span class="linenos"> 38</span></a><span class="sd">        :param server_address: Optional[list[str , int] | tuple[str, int] | str]: If signal-cli is already started,</span>
</span><span id="SignalCli-39"><a href="#SignalCli-39"><span class="linenos"> 39</span></a><span class="sd">            the address of the server, if a unix socket, use a str, otherwise use a tuple/list[hostname:str,port:int]</span>
</span><span id="SignalCli-40"><a href="#SignalCli-40"><span class="linenos"> 40</span></a><span class="sd">        :param log_file_path: Optional[str]: The path to the signal log file, if None, no logging is preformed.</span>
</span><span id="SignalCli-41"><a href="#SignalCli-41"><span class="linenos"> 41</span></a><span class="sd">        :param start_signal: Bool: True = start a signal-cli process, False = signal-cli is already running.</span>
</span><span id="SignalCli-42"><a href="#SignalCli-42"><span class="linenos"> 42</span></a><span class="sd">        :param callback: Optional[tuple[Callable, Optional[list[Any]]]]: The call back as a tuple, the first element</span>
</span><span id="SignalCli-43"><a href="#SignalCli-43"><span class="linenos"> 43</span></a><span class="sd">            being the callable, and the second element; If not None, is a list of any parameters to provide to the</span>
</span><span id="SignalCli-44"><a href="#SignalCli-44"><span class="linenos"> 44</span></a><span class="sd">            callback.  The callback signature is: (status: str, *params)</span>
</span><span id="SignalCli-45"><a href="#SignalCli-45"><span class="linenos"> 45</span></a><span class="sd">        :param debug: Bool: Produce debug output on stdout.</span>
</span><span id="SignalCli-46"><a href="#SignalCli-46"><span class="linenos"> 46</span></a><span class="sd">        :raises TypeError: If a parameter is of invalid type.</span>
</span><span id="SignalCli-47"><a href="#SignalCli-47"><span class="linenos"> 47</span></a><span class="sd">        :raises FileNotFoundError: If a file / directory doesn&#39;t exist when it should.</span>
</span><span id="SignalCli-48"><a href="#SignalCli-48"><span class="linenos"> 48</span></a><span class="sd">        :raises FileExistsError: If a socket file exists when it shouldn&#39;t.</span>
</span><span id="SignalCli-49"><a href="#SignalCli-49"><span class="linenos"> 49</span></a><span class="sd">        :raises RuntimeError: If an error occurs while loading signal data, more information in the error message.</span>
</span><span id="SignalCli-50"><a href="#SignalCli-50"><span class="linenos"> 50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-51"><a href="#SignalCli-51"><span class="linenos"> 51</span></a>        <span class="c1"># Super:</span>
</span><span id="SignalCli-52"><a href="#SignalCli-52"><span class="linenos"> 52</span></a>        <span class="nb">object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SignalCli-53"><a href="#SignalCli-53"><span class="linenos"> 53</span></a>
</span><span id="SignalCli-54"><a href="#SignalCli-54"><span class="linenos"> 54</span></a>        <span class="c1"># Setup logging.</span>
</span><span id="SignalCli-55"><a href="#SignalCli-55"><span class="linenos"> 55</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-56"><a href="#SignalCli-56"><span class="linenos"> 56</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialize.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-57"><a href="#SignalCli-57"><span class="linenos"> 57</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="SignalCli-58"><a href="#SignalCli-58"><span class="linenos"> 58</span></a>
</span><span id="SignalCli-59"><a href="#SignalCli-59"><span class="linenos"> 59</span></a>        <span class="c1"># Check signal config path:</span>
</span><span id="SignalCli-60"><a href="#SignalCli-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-61"><a href="#SignalCli-61"><span class="linenos"> 61</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-62"><a href="#SignalCli-62"><span class="linenos"> 62</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-63"><a href="#SignalCli-63"><span class="linenos"> 63</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_config_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_config_path</span><span class="p">)</span>
</span><span id="SignalCli-64"><a href="#SignalCli-64"><span class="linenos"> 64</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-65"><a href="#SignalCli-65"><span class="linenos"> 65</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_config_path &#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t exist.&quot;</span> <span class="o">%</span> <span class="n">signal_config_path</span>
</span><span id="SignalCli-66"><a href="#SignalCli-66"><span class="linenos"> 66</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-67"><a href="#SignalCli-67"><span class="linenos"> 67</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-68"><a href="#SignalCli-68"><span class="linenos"> 68</span></a>
</span><span id="SignalCli-69"><a href="#SignalCli-69"><span class="linenos"> 69</span></a>        <span class="c1"># Check signal exec path:</span>
</span><span id="SignalCli-70"><a href="#SignalCli-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-71"><a href="#SignalCli-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-72"><a href="#SignalCli-72"><span class="linenos"> 72</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-73"><a href="#SignalCli-73"><span class="linenos"> 73</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_exec_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_exec_path</span><span class="p">)</span>
</span><span id="SignalCli-74"><a href="#SignalCli-74"><span class="linenos"> 74</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-75"><a href="#SignalCli-75"><span class="linenos"> 75</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_exec_path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">signal_exec_path</span>
</span><span id="SignalCli-76"><a href="#SignalCli-76"><span class="linenos"> 76</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-77"><a href="#SignalCli-77"><span class="linenos"> 77</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-78"><a href="#SignalCli-78"><span class="linenos"> 78</span></a>
</span><span id="SignalCli-79"><a href="#SignalCli-79"><span class="linenos"> 79</span></a>        <span class="c1"># Check start signal:</span>
</span><span id="SignalCli-80"><a href="#SignalCli-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_signal</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli-81"><a href="#SignalCli-81"><span class="linenos"> 81</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-82"><a href="#SignalCli-82"><span class="linenos"> 82</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;start_signal&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">start_signal</span><span class="p">)</span>
</span><span id="SignalCli-83"><a href="#SignalCli-83"><span class="linenos"> 83</span></a>
</span><span id="SignalCli-84"><a href="#SignalCli-84"><span class="linenos"> 84</span></a>        <span class="c1"># Check the server address:</span>
</span><span id="SignalCli-85"><a href="#SignalCli-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-86"><a href="#SignalCli-86"><span class="linenos"> 86</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="SignalCli-87"><a href="#SignalCli-87"><span class="linenos"> 87</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SignalCli-88"><a href="#SignalCli-88"><span class="linenos"> 88</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;server_address must have a length of 2.&quot;</span>
</span><span id="SignalCli-89"><a href="#SignalCli-89"><span class="linenos"> 89</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising ValueError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-90"><a href="#SignalCli-90"><span class="linenos"> 90</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-91"><a href="#SignalCli-91"><span class="linenos"> 91</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-92"><a href="#SignalCli-92"><span class="linenos"> 92</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-93"><a href="#SignalCli-93"><span class="linenos"> 93</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[0]&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SignalCli-94"><a href="#SignalCli-94"><span class="linenos"> 94</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="SignalCli-95"><a href="#SignalCli-95"><span class="linenos"> 95</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-96"><a href="#SignalCli-96"><span class="linenos"> 96</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[1]&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SignalCli-97"><a href="#SignalCli-97"><span class="linenos"> 97</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-98"><a href="#SignalCli-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-99"><a href="#SignalCli-99"><span class="linenos"> 99</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; already exists. Perhaps signal is already running.&quot;</span> \
</span><span id="SignalCli-100"><a href="#SignalCli-100"><span class="linenos">100</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="SignalCli-101"><a href="#SignalCli-101"><span class="linenos">101</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileExistsError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-102"><a href="#SignalCli-102"><span class="linenos">102</span></a>                    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-103"><a href="#SignalCli-103"><span class="linenos">103</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-104"><a href="#SignalCli-104"><span class="linenos">104</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist. Perhaps signal isn&#39;t running.&quot;</span> \
</span><span id="SignalCli-105"><a href="#SignalCli-105"><span class="linenos">105</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="SignalCli-106"><a href="#SignalCli-106"><span class="linenos">106</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileNotFoundError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-107"><a href="#SignalCli-107"><span class="linenos">107</span></a>                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-108"><a href="#SignalCli-108"><span class="linenos">108</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-109"><a href="#SignalCli-109"><span class="linenos">109</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-110"><a href="#SignalCli-110"><span class="linenos">110</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;server_address&#39;</span><span class="p">,</span> <span class="s1">&#39;list[str, int] | tuple[str, int] | str&#39;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>
</span><span id="SignalCli-111"><a href="#SignalCli-111"><span class="linenos">111</span></a>
</span><span id="SignalCli-112"><a href="#SignalCli-112"><span class="linenos">112</span></a>        <span class="c1"># Check the log file path:</span>
</span><span id="SignalCli-113"><a href="#SignalCli-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">log_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-114"><a href="#SignalCli-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-115"><a href="#SignalCli-115"><span class="linenos">115</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-116"><a href="#SignalCli-116"><span class="linenos">116</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;log_file_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">log_file_path</span><span class="p">)</span>
</span><span id="SignalCli-117"><a href="#SignalCli-117"><span class="linenos">117</span></a>
</span><span id="SignalCli-118"><a href="#SignalCli-118"><span class="linenos">118</span></a>        <span class="c1"># Check callback:</span>
</span><span id="SignalCli-119"><a href="#SignalCli-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-120"><a href="#SignalCli-120"><span class="linenos">120</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="SignalCli-121"><a href="#SignalCli-121"><span class="linenos">121</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-122"><a href="#SignalCli-122"><span class="linenos">122</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[tuple[Callable, Optional[list[Any]]]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="SignalCli-123"><a href="#SignalCli-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SignalCli-124"><a href="#SignalCli-124"><span class="linenos">124</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;callback must be 2 elements long.&quot;</span>
</span><span id="SignalCli-125"><a href="#SignalCli-125"><span class="linenos">125</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-126"><a href="#SignalCli-126"><span class="linenos">126</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-127"><a href="#SignalCli-127"><span class="linenos">127</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">]):</span>
</span><span id="SignalCli-128"><a href="#SignalCli-128"><span class="linenos">128</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-129"><a href="#SignalCli-129"><span class="linenos">129</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[0]&#39;</span><span class="p">,</span> <span class="s1">&#39;Callable&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">])</span>
</span><span id="SignalCli-130"><a href="#SignalCli-130"><span class="linenos">130</span></a>            <span class="k">elif</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="SignalCli-131"><a href="#SignalCli-131"><span class="linenos">131</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-132"><a href="#SignalCli-132"><span class="linenos">132</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[1]&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[list[Any]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">])</span>
</span><span id="SignalCli-133"><a href="#SignalCli-133"><span class="linenos">133</span></a>
</span><span id="SignalCli-134"><a href="#SignalCli-134"><span class="linenos">134</span></a>        <span class="c1"># Check debug:</span>
</span><span id="SignalCli-135"><a href="#SignalCli-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli-136"><a href="#SignalCli-136"><span class="linenos">136</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-137"><a href="#SignalCli-137"><span class="linenos">137</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="SignalCli-138"><a href="#SignalCli-138"><span class="linenos">138</span></a>
</span><span id="SignalCli-139"><a href="#SignalCli-139"><span class="linenos">139</span></a>        <span class="c1"># Set internal vars:</span>
</span><span id="SignalCli-140"><a href="#SignalCli-140"><span class="linenos">140</span></a>        <span class="c1"># Set the config path:</span>
</span><span id="SignalCli-141"><a href="#SignalCli-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="SignalCli-142"><a href="#SignalCli-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal config directory.&quot;&quot;&quot;</span>
</span><span id="SignalCli-143"><a href="#SignalCli-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-144"><a href="#SignalCli-144"><span class="linenos">144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">signal_config_path</span>
</span><span id="SignalCli-145"><a href="#SignalCli-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-146"><a href="#SignalCli-146"><span class="linenos">146</span></a>            <span class="n">home_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">)</span>
</span><span id="SignalCli-147"><a href="#SignalCli-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_path</span><span class="p">,</span> <span class="s1">&#39;.local&#39;</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="s1">&#39;signal-cli&#39;</span><span class="p">)</span>
</span><span id="SignalCli-148"><a href="#SignalCli-148"><span class="linenos">148</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli config path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="SignalCli-149"><a href="#SignalCli-149"><span class="linenos">149</span></a>
</span><span id="SignalCli-150"><a href="#SignalCli-150"><span class="linenos">150</span></a>        <span class="c1"># Set signal exec path:</span>
</span><span id="SignalCli-151"><a href="#SignalCli-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signalExecPath</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="SignalCli-152"><a href="#SignalCli-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal-cli executable.&quot;&quot;&quot;</span>
</span><span id="SignalCli-153"><a href="#SignalCli-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-154"><a href="#SignalCli-154"><span class="linenos">154</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to passed parameter.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-155"><a href="#SignalCli-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">signal_exec_path</span>
</span><span id="SignalCli-156"><a href="#SignalCli-156"><span class="linenos">156</span></a>        <span class="k">elif</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-157"><a href="#SignalCli-157"><span class="linenos">157</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finding signal_exec_path.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-158"><a href="#SignalCli-158"><span class="linenos">158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">__find_signal__</span><span class="p">()</span>  <span class="c1"># Raises FileNotFoundError if signal-cli not found.</span>
</span><span id="SignalCli-159"><a href="#SignalCli-159"><span class="linenos">159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-160"><a href="#SignalCli-160"><span class="linenos">160</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to None.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-161"><a href="#SignalCli-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-162"><a href="#SignalCli-162"><span class="linenos">162</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli exec path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span><span class="p">)</span>
</span><span id="SignalCli-163"><a href="#SignalCli-163"><span class="linenos">163</span></a>
</span><span id="SignalCli-164"><a href="#SignalCli-164"><span class="linenos">164</span></a>        <span class="c1"># Set server address:</span>
</span><span id="SignalCli-165"><a href="#SignalCli-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
</span><span id="SignalCli-166"><a href="#SignalCli-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;The server address of the signal-cli socket.&quot;&quot;&quot;</span>
</span><span id="SignalCli-167"><a href="#SignalCli-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-168"><a href="#SignalCli-168"><span class="linenos">168</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting server_address from parameter.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-169"><a href="#SignalCli-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">server_address</span>
</span><span id="SignalCli-170"><a href="#SignalCli-170"><span class="linenos">170</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-171"><a href="#SignalCli-171"><span class="linenos">171</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building server_address, selecting UNIX socket.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-172"><a href="#SignalCli-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">)</span>
</span><span id="SignalCli-173"><a href="#SignalCli-173"><span class="linenos">173</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Server address: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">))</span>
</span><span id="SignalCli-174"><a href="#SignalCli-174"><span class="linenos">174</span></a>
</span><span id="SignalCli-175"><a href="#SignalCli-175"><span class="linenos">175</span></a>        <span class="c1"># Store debug:</span>
</span><span id="SignalCli-176"><a href="#SignalCli-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="SignalCli-177"><a href="#SignalCli-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if we should produce debugging output.&quot;&quot;&quot;</span>
</span><span id="SignalCli-178"><a href="#SignalCli-178"><span class="linenos">178</span></a>        <span class="c1"># Store log file path:</span>
</span><span id="SignalCli-179"><a href="#SignalCli-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_file_path</span>
</span><span id="SignalCli-180"><a href="#SignalCli-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The path to the signal-cli log file.&quot;&quot;&quot;</span>
</span><span id="SignalCli-181"><a href="#SignalCli-181"><span class="linenos">181</span></a>        <span class="c1"># Store callback:</span>
</span><span id="SignalCli-182"><a href="#SignalCli-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="n">callback</span>
</span><span id="SignalCli-183"><a href="#SignalCli-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The start up call back.&quot;&quot;&quot;</span>
</span><span id="SignalCli-184"><a href="#SignalCli-184"><span class="linenos">184</span></a>        <span class="c1"># set var to hold the main signal process</span>
</span><span id="SignalCli-185"><a href="#SignalCli-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Popen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-186"><a href="#SignalCli-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The main signal-cli process.&quot;&quot;&quot;</span>
</span><span id="SignalCli-187"><a href="#SignalCli-187"><span class="linenos">187</span></a>        <span class="c1"># Set sync socket:</span>
</span><span id="SignalCli-188"><a href="#SignalCli-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-189"><a href="#SignalCli-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform sync operations with.&quot;&quot;&quot;</span>
</span><span id="SignalCli-190"><a href="#SignalCli-190"><span class="linenos">190</span></a>        <span class="c1"># Set command socket:</span>
</span><span id="SignalCli-191"><a href="#SignalCli-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-192"><a href="#SignalCli-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform command operations with.&quot;&quot;&quot;</span>
</span><span id="SignalCli-193"><a href="#SignalCli-193"><span class="linenos">193</span></a>        <span class="c1"># Set var to hold the link request:</span>
</span><span id="SignalCli-194"><a href="#SignalCli-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-195"><a href="#SignalCli-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The signal-cli request for linking a new account.&quot;&quot;&quot;</span>
</span><span id="SignalCli-196"><a href="#SignalCli-196"><span class="linenos">196</span></a>        <span class="c1"># Set qrencode exec path:</span>
</span><span id="SignalCli-197"><a href="#SignalCli-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">__find_qrencode__</span><span class="p">()</span>
</span><span id="SignalCli-198"><a href="#SignalCli-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the qrencode executable.&quot;&quot;&quot;</span>
</span><span id="SignalCli-199"><a href="#SignalCli-199"><span class="linenos">199</span></a>        <span class="c1"># Set external properties and objects:</span>
</span><span id="SignalCli-200"><a href="#SignalCli-200"><span class="linenos">200</span></a>        <span class="c1"># Set accounts:</span>
</span><span id="SignalCli-201"><a href="#SignalCli-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Accounts</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-202"><a href="#SignalCli-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="SignalCli-203"><a href="#SignalCli-203"><span class="linenos">203</span></a>        <span class="c1"># Set sticker packs:</span>
</span><span id="SignalCli-204"><a href="#SignalCli-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StickerPacks</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-205"><a href="#SignalCli-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="SignalCli-206"><a href="#SignalCli-206"><span class="linenos">206</span></a>        <span class="c1"># Start signal-cli if requested:</span>
</span><span id="SignalCli-207"><a href="#SignalCli-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-208"><a href="#SignalCli-208"><span class="linenos">208</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-209"><a href="#SignalCli-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;starting signal-cli&#39;</span><span class="p">)</span>
</span><span id="SignalCli-210"><a href="#SignalCli-210"><span class="linenos">210</span></a>            <span class="n">signal_command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_signal_command_line__</span><span class="p">()</span>
</span><span id="SignalCli-211"><a href="#SignalCli-211"><span class="linenos">211</span></a>            <span class="n">response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">CalledProcessError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_signal__</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">)</span>
</span><span id="SignalCli-212"><a href="#SignalCli-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SignalCli-213"><a href="#SignalCli-213"><span class="linenos">213</span></a>                <span class="n">__parse_signal_return_code__</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">signal_command_line</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>  <span class="c1"># NoReturn</span>
</span><span id="SignalCli-214"><a href="#SignalCli-214"><span class="linenos">214</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-215"><a href="#SignalCli-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli started&quot;</span><span class="p">)</span>
</span><span id="SignalCli-216"><a href="#SignalCli-216"><span class="linenos">216</span></a>
</span><span id="SignalCli-217"><a href="#SignalCli-217"><span class="linenos">217</span></a>        <span class="c1"># Wait for the socket to appear:</span>
</span><span id="SignalCli-218"><a href="#SignalCli-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-219"><a href="#SignalCli-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli-220"><a href="#SignalCli-220"><span class="linenos">220</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;server_address is a socket, and we&#39;re starting signal, wait for socket to appear.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-221"><a href="#SignalCli-221"><span class="linenos">221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;start waiting for socket&quot;</span><span class="p">)</span>
</span><span id="SignalCli-222"><a href="#SignalCli-222"><span class="linenos">222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_signal_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>
</span><span id="SignalCli-223"><a href="#SignalCli-223"><span class="linenos">223</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;socket found.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-224"><a href="#SignalCli-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;socket found&#39;</span><span class="p">)</span>
</span><span id="SignalCli-225"><a href="#SignalCli-225"><span class="linenos">225</span></a>
</span><span id="SignalCli-226"><a href="#SignalCli-226"><span class="linenos">226</span></a>        <span class="c1"># Create sockets and connect to them:</span>
</span><span id="SignalCli-227"><a href="#SignalCli-227"><span class="linenos">227</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting to sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-228"><a href="#SignalCli-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connecting to sockets&#39;</span><span class="p">)</span>
</span><span id="SignalCli-229"><a href="#SignalCli-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__connect_to_sockets__</span><span class="p">()</span>
</span><span id="SignalCli-230"><a href="#SignalCli-230"><span class="linenos">230</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connected to sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-231"><a href="#SignalCli-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connected to sockets&#39;</span><span class="p">)</span>
</span><span id="SignalCli-232"><a href="#SignalCli-232"><span class="linenos">232</span></a>
</span><span id="SignalCli-233"><a href="#SignalCli-233"><span class="linenos">233</span></a>        <span class="c1"># Load stickers:</span>
</span><span id="SignalCli-234"><a href="#SignalCli-234"><span class="linenos">234</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading sticker packs.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-235"><a href="#SignalCli-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span> <span class="o">=</span> <span class="n">StickerPacks</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="SignalCli-236"><a href="#SignalCli-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="SignalCli-237"><a href="#SignalCli-237"><span class="linenos">237</span></a>
</span><span id="SignalCli-238"><a href="#SignalCli-238"><span class="linenos">238</span></a>        <span class="c1"># Load accounts:</span>
</span><span id="SignalCli-239"><a href="#SignalCli-239"><span class="linenos">239</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading accounts.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-240"><a href="#SignalCli-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">Accounts</span><span class="p">(</span><span class="n">sync_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="SignalCli-241"><a href="#SignalCli-241"><span class="linenos">241</span></a>                                 <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span> <span class="n">do_load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SignalCli-242"><a href="#SignalCli-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="SignalCli-243"><a href="#SignalCli-243"><span class="linenos">243</span></a>
</span><span id="SignalCli-244"><a href="#SignalCli-244"><span class="linenos">244</span></a>        <span class="c1"># Create dict to hold processes:</span>
</span><span id="SignalCli-245"><a href="#SignalCli-245"><span class="linenos">245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReceiveThread</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SignalCli-246"><a href="#SignalCli-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The dict to store the receive threads.&quot;&quot;&quot;</span>
</span><span id="SignalCli-247"><a href="#SignalCli-247"><span class="linenos">247</span></a>
</span><span id="SignalCli-248"><a href="#SignalCli-248"><span class="linenos">248</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialization complete.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-249"><a href="#SignalCli-249"><span class="linenos">249</span></a>        <span class="k">return</span>
</span><span id="SignalCli-250"><a href="#SignalCli-250"><span class="linenos">250</span></a>
</span><span id="SignalCli-251"><a href="#SignalCli-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">__connect_to_sockets__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="SignalCli-252"><a href="#SignalCli-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-253"><a href="#SignalCli-253"><span class="linenos">253</span></a><span class="sd">        Connect to and store the sockets.</span>
</span><span id="SignalCli-254"><a href="#SignalCli-254"><span class="linenos">254</span></a><span class="sd">        :return: None | NoReturn.</span>
</span><span id="SignalCli-255"><a href="#SignalCli-255"><span class="linenos">255</span></a><span class="sd">        :raises CommunicationsError: On error creating or connecting to a socket.</span>
</span><span id="SignalCli-256"><a href="#SignalCli-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-257"><a href="#SignalCli-257"><span class="linenos">257</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__connect_to_sockets__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-258"><a href="#SignalCli-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span> <span class="o">=</span> <span class="n">__socket_create__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-259"><a href="#SignalCli-259"><span class="linenos">259</span></a>        <span class="n">__socket_connect__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-260"><a href="#SignalCli-260"><span class="linenos">260</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connected to command socket.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-261"><a href="#SignalCli-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span> <span class="o">=</span> <span class="n">__socket_create__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-262"><a href="#SignalCli-262"><span class="linenos">262</span></a>        <span class="n">__socket_connect__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-263"><a href="#SignalCli-263"><span class="linenos">263</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Connected to sync socket.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-264"><a href="#SignalCli-264"><span class="linenos">264</span></a>        <span class="k">return</span>
</span><span id="SignalCli-265"><a href="#SignalCli-265"><span class="linenos">265</span></a>
</span><span id="SignalCli-266"><a href="#SignalCli-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">__close_sockets__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="SignalCli-267"><a href="#SignalCli-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-268"><a href="#SignalCli-268"><span class="linenos">268</span></a><span class="sd">        Close and clear sockets.</span>
</span><span id="SignalCli-269"><a href="#SignalCli-269"><span class="linenos">269</span></a><span class="sd">        :return: None | NoReturn: None if all closed, NoReturn on error closing socket.</span>
</span><span id="SignalCli-270"><a href="#SignalCli-270"><span class="linenos">270</span></a><span class="sd">        :raises CommunicationError: On error closing socket.</span>
</span><span id="SignalCli-271"><a href="#SignalCli-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-272"><a href="#SignalCli-272"><span class="linenos">272</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__close_sockets__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-273"><a href="#SignalCli-273"><span class="linenos">273</span></a>        <span class="n">__socket_close__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-274"><a href="#SignalCli-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-275"><a href="#SignalCli-275"><span class="linenos">275</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sync socket closed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-276"><a href="#SignalCli-276"><span class="linenos">276</span></a>        <span class="n">__socket_close__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>  <span class="c1"># Raises CommunicationsError</span>
</span><span id="SignalCli-277"><a href="#SignalCli-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-278"><a href="#SignalCli-278"><span class="linenos">278</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Command socket closed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-279"><a href="#SignalCli-279"><span class="linenos">279</span></a>        <span class="k">return</span>
</span><span id="SignalCli-280"><a href="#SignalCli-280"><span class="linenos">280</span></a>
</span><span id="SignalCli-281"><a href="#SignalCli-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">__wait_for_signal_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-282"><a href="#SignalCli-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-283"><a href="#SignalCli-283"><span class="linenos">283</span></a><span class="sd">        Wait for the signal socket file to appear.</span>
</span><span id="SignalCli-284"><a href="#SignalCli-284"><span class="linenos">284</span></a><span class="sd">        :param socket_file_path: str: The full path to the socket file.</span>
</span><span id="SignalCli-285"><a href="#SignalCli-285"><span class="linenos">285</span></a><span class="sd">        :param timeout: float: The timeout in .5 second increments.</span>
</span><span id="SignalCli-286"><a href="#SignalCli-286"><span class="linenos">286</span></a><span class="sd">        :return: None</span>
</span><span id="SignalCli-287"><a href="#SignalCli-287"><span class="linenos">287</span></a><span class="sd">        :raises TimeoutError on timeout.</span>
</span><span id="SignalCli-288"><a href="#SignalCli-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-289"><a href="#SignalCli-289"><span class="linenos">289</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_signal_socket_file__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-290"><a href="#SignalCli-290"><span class="linenos">290</span></a>        <span class="n">current_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SignalCli-291"><a href="#SignalCli-291"><span class="linenos">291</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">socket_file_path</span><span class="p">):</span>
</span><span id="SignalCli-292"><a href="#SignalCli-292"><span class="linenos">292</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Waiting for socket...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-293"><a href="#SignalCli-293"><span class="linenos">293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;waiting for socket&#39;</span><span class="p">)</span>
</span><span id="SignalCli-294"><a href="#SignalCli-294"><span class="linenos">294</span></a>            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="SignalCli-295"><a href="#SignalCli-295"><span class="linenos">295</span></a>            <span class="n">current_time</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="SignalCli-296"><a href="#SignalCli-296"><span class="linenos">296</span></a>            <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="SignalCli-297"><a href="#SignalCli-297"><span class="linenos">297</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;timeout while waiting for signal to create socket.&quot;</span>
</span><span id="SignalCli-298"><a href="#SignalCli-298"><span class="linenos">298</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TimeoutError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-299"><a href="#SignalCli-299"><span class="linenos">299</span></a>                <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-300"><a href="#SignalCli-300"><span class="linenos">300</span></a>        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Give it a second to stabilize</span>
</span><span id="SignalCli-301"><a href="#SignalCli-301"><span class="linenos">301</span></a>        <span class="k">return</span>
</span><span id="SignalCli-302"><a href="#SignalCli-302"><span class="linenos">302</span></a>
</span><span id="SignalCli-303"><a href="#SignalCli-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">__build_signal_command_line__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="SignalCli-304"><a href="#SignalCli-304"><span class="linenos">304</span></a>        <span class="c1"># Build signal-cli command line:</span>
</span><span id="SignalCli-305"><a href="#SignalCli-305"><span class="linenos">305</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_signal_command_line__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-306"><a href="#SignalCli-306"><span class="linenos">306</span></a>        <span class="n">signal_command_line</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span><span class="p">]</span>
</span><span id="SignalCli-307"><a href="#SignalCli-307"><span class="linenos">307</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-308"><a href="#SignalCli-308"><span class="linenos">308</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;--log-file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span><span class="p">])</span>
</span><span id="SignalCli-309"><a href="#SignalCli-309"><span class="linenos">309</span></a>        <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--config&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;daemon&#39;</span><span class="p">])</span>
</span><span id="SignalCli-310"><a href="#SignalCli-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-311"><a href="#SignalCli-311"><span class="linenos">311</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--socket&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">])</span>
</span><span id="SignalCli-312"><a href="#SignalCli-312"><span class="linenos">312</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-313"><a href="#SignalCli-313"><span class="linenos">313</span></a>            <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SignalCli-314"><a href="#SignalCli-314"><span class="linenos">314</span></a>            <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--tcp&#39;</span><span class="p">,</span> <span class="n">address</span><span class="p">])</span>
</span><span id="SignalCli-315"><a href="#SignalCli-315"><span class="linenos">315</span></a>        <span class="n">signal_command_line</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--no-receive-stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;--receive-mode&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">])</span>
</span><span id="SignalCli-316"><a href="#SignalCli-316"><span class="linenos">316</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Signal command line: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">))</span>
</span><span id="SignalCli-317"><a href="#SignalCli-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="n">signal_command_line</span>
</span><span id="SignalCli-318"><a href="#SignalCli-318"><span class="linenos">318</span></a>
</span><span id="SignalCli-319"><a href="#SignalCli-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">__start_signal__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal_command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="SignalCli-320"><a href="#SignalCli-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-321"><a href="#SignalCli-321"><span class="linenos">321</span></a><span class="sd">        Start and store the signal-cli process.</span>
</span><span id="SignalCli-322"><a href="#SignalCli-322"><span class="linenos">322</span></a><span class="sd">        :param signal_command_line: list[str]: The command line to run.</span>
</span><span id="SignalCli-323"><a href="#SignalCli-323"><span class="linenos">323</span></a><span class="sd">        :return: True | CalledProcessError: True if started, Called process error on exit-code &gt; 0.</span>
</span><span id="SignalCli-324"><a href="#SignalCli-324"><span class="linenos">324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-325"><a href="#SignalCli-325"><span class="linenos">325</span></a>        <span class="c1"># Log start:</span>
</span><span id="SignalCli-326"><a href="#SignalCli-326"><span class="linenos">326</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_signal__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-327"><a href="#SignalCli-327"><span class="linenos">327</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-328"><a href="#SignalCli-328"><span class="linenos">328</span></a>        <span class="c1"># Run signal-cli in daemon mode:</span>
</span><span id="SignalCli-329"><a href="#SignalCli-329"><span class="linenos">329</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-330"><a href="#SignalCli-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
</span><span id="SignalCli-331"><a href="#SignalCli-331"><span class="linenos">331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="SignalCli-332"><a href="#SignalCli-332"><span class="linenos">332</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-333"><a href="#SignalCli-333"><span class="linenos">333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="SignalCli-334"><a href="#SignalCli-334"><span class="linenos">334</span></a>        <span class="k">except</span> <span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SignalCli-335"><a href="#SignalCli-335"><span class="linenos">335</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Failed to start signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-336"><a href="#SignalCli-336"><span class="linenos">336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;failed to start signal-cli&quot;</span><span class="p">)</span>
</span><span id="SignalCli-337"><a href="#SignalCli-337"><span class="linenos">337</span></a>            <span class="k">return</span> <span class="n">e</span>
</span><span id="SignalCli-338"><a href="#SignalCli-338"><span class="linenos">338</span></a>
</span><span id="SignalCli-339"><a href="#SignalCli-339"><span class="linenos">339</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-340"><a href="#SignalCli-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-341"><a href="#SignalCli-341"><span class="linenos">341</span></a>
</span><span id="SignalCli-342"><a href="#SignalCli-342"><span class="linenos">342</span></a>        <span class="c1"># Give signal 5 seconds to start</span>
</span><span id="SignalCli-343"><a href="#SignalCli-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;Waiting for signal-cli to initialize.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-344"><a href="#SignalCli-344"><span class="linenos">344</span></a>        <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="SignalCli-345"><a href="#SignalCli-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;signal-cli initialized.&#39;</span><span class="p">)</span>
</span><span id="SignalCli-346"><a href="#SignalCli-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="SignalCli-347"><a href="#SignalCli-347"><span class="linenos">347</span></a>
</span><span id="SignalCli-348"><a href="#SignalCli-348"><span class="linenos">348</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-349"><a href="#SignalCli-349"><span class="linenos">349</span></a>    <span class="c1"># Internal methods:</span>
</span><span id="SignalCli-350"><a href="#SignalCli-350"><span class="linenos">350</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-351"><a href="#SignalCli-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">__run_callback__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-352"><a href="#SignalCli-352"><span class="linenos">352</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-353"><a href="#SignalCli-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-354"><a href="#SignalCli-354"><span class="linenos">354</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Callback not defined, skipping.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-355"><a href="#SignalCli-355"><span class="linenos">355</span></a>            <span class="k">return</span>
</span><span id="SignalCli-356"><a href="#SignalCli-356"><span class="linenos">356</span></a>        <span class="n">callback_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="SignalCli-357"><a href="#SignalCli-357"><span class="linenos">357</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Running callback &#39;</span><span class="si">%s</span><span class="s2">&#39; with status: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callback_name</span><span class="p">,</span> <span class="n">status</span><span class="p">))</span>
</span><span id="SignalCli-358"><a href="#SignalCli-358"><span class="linenos">358</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-359"><a href="#SignalCli-359"><span class="linenos">359</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-360"><a href="#SignalCli-360"><span class="linenos">360</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">](</span><span class="n">status</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">])</span>
</span><span id="SignalCli-361"><a href="#SignalCli-361"><span class="linenos">361</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-362"><a href="#SignalCli-362"><span class="linenos">362</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">](</span><span class="n">status</span><span class="p">)</span>
</span><span id="SignalCli-363"><a href="#SignalCli-363"><span class="linenos">363</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SignalCli-364"><a href="#SignalCli-364"><span class="linenos">364</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; Exception while running callback: &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
</span><span id="SignalCli-365"><a href="#SignalCli-365"><span class="linenos">365</span></a>                           <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">callback_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>
</span><span id="SignalCli-366"><a href="#SignalCli-366"><span class="linenos">366</span></a>            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Callback raised an exception: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="SignalCli-367"><a href="#SignalCli-367"><span class="linenos">367</span></a>        <span class="k">return</span>
</span><span id="SignalCli-368"><a href="#SignalCli-368"><span class="linenos">368</span></a>
</span><span id="SignalCli-369"><a href="#SignalCli-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="nf">__remove_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SignalCli-370"><a href="#SignalCli-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-371"><a href="#SignalCli-371"><span class="linenos">371</span></a><span class="sd">        Remove the signal socket file.</span>
</span><span id="SignalCli-372"><a href="#SignalCli-372"><span class="linenos">372</span></a><span class="sd">        :return: bool: Returns True when the file is removed, False if it wasn&#39;t.</span>
</span><span id="SignalCli-373"><a href="#SignalCli-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-374"><a href="#SignalCli-374"><span class="linenos">374</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__remove_socket_file__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-375"><a href="#SignalCli-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">):</span>
</span><span id="SignalCli-376"><a href="#SignalCli-376"><span class="linenos">376</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing old socket file.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-377"><a href="#SignalCli-377"><span class="linenos">377</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-378"><a href="#SignalCli-378"><span class="linenos">378</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>
</span><span id="SignalCli-379"><a href="#SignalCli-379"><span class="linenos">379</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="SignalCli-380"><a href="#SignalCli-380"><span class="linenos">380</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SignalCli-381"><a href="#SignalCli-381"><span class="linenos">381</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to remove old socket file: &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>
</span><span id="SignalCli-382"><a href="#SignalCli-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="SignalCli-383"><a href="#SignalCli-383"><span class="linenos">383</span></a>
</span><span id="SignalCli-384"><a href="#SignalCli-384"><span class="linenos">384</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-385"><a href="#SignalCli-385"><span class="linenos">385</span></a>    <span class="c1"># Overrides:</span>
</span><span id="SignalCli-386"><a href="#SignalCli-386"><span class="linenos">386</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-387"><a href="#SignalCli-387"><span class="linenos">387</span></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SignalCli-388"><a href="#SignalCli-388"><span class="linenos">388</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-389"><a href="#SignalCli-389"><span class="linenos">389</span></a>
</span><span id="SignalCli-390"><a href="#SignalCli-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-391"><a href="#SignalCli-391"><span class="linenos">391</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-392"><a href="#SignalCli-392"><span class="linenos">392</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="p">()</span>
</span><span id="SignalCli-393"><a href="#SignalCli-393"><span class="linenos">393</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SignalCli-394"><a href="#SignalCli-394"><span class="linenos">394</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error occurred during termination of signal-cli process.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-395"><a href="#SignalCli-395"><span class="linenos">395</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</span><span id="SignalCli-396"><a href="#SignalCli-396"><span class="linenos">396</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error strArgs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
</span><span id="SignalCli-397"><a href="#SignalCli-397"><span class="linenos">397</span></a>
</span><span id="SignalCli-398"><a href="#SignalCli-398"><span class="linenos">398</span></a>        <span class="k">return</span>
</span><span id="SignalCli-399"><a href="#SignalCli-399"><span class="linenos">399</span></a>
</span><span id="SignalCli-400"><a href="#SignalCli-400"><span class="linenos">400</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-401"><a href="#SignalCli-401"><span class="linenos">401</span></a>    <span class="c1"># Methods:</span>
</span><span id="SignalCli-402"><a href="#SignalCli-402"><span class="linenos">402</span></a>    <span class="c1">#################################</span>
</span><span id="SignalCli-403"><a href="#SignalCli-403"><span class="linenos">403</span></a>    <span class="k">def</span> <span class="nf">stop_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-404"><a href="#SignalCli-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-405"><a href="#SignalCli-405"><span class="linenos">405</span></a><span class="sd">        Stop the signal-cli process.</span>
</span><span id="SignalCli-406"><a href="#SignalCli-406"><span class="linenos">406</span></a><span class="sd">        :returns: None</span>
</span><span id="SignalCli-407"><a href="#SignalCli-407"><span class="linenos">407</span></a><span class="sd">        :raises CommunicationsError: On error closing a socket.</span>
</span><span id="SignalCli-408"><a href="#SignalCli-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-409"><a href="#SignalCli-409"><span class="linenos">409</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-410"><a href="#SignalCli-410"><span class="linenos">410</span></a>        <span class="c1"># Close the sockets:</span>
</span><span id="SignalCli-411"><a href="#SignalCli-411"><span class="linenos">411</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Closing sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-412"><a href="#SignalCli-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;closing sockets&quot;</span><span class="p">)</span>
</span><span id="SignalCli-413"><a href="#SignalCli-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__close_sockets__</span><span class="p">()</span>
</span><span id="SignalCli-414"><a href="#SignalCli-414"><span class="linenos">414</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sockets closed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-415"><a href="#SignalCli-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;sockets closed&quot;</span><span class="p">)</span>
</span><span id="SignalCli-416"><a href="#SignalCli-416"><span class="linenos">416</span></a>
</span><span id="SignalCli-417"><a href="#SignalCli-417"><span class="linenos">417</span></a>        <span class="c1"># Terminate process:</span>
</span><span id="SignalCli-418"><a href="#SignalCli-418"><span class="linenos">418</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-419"><a href="#SignalCli-419"><span class="linenos">419</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-420"><a href="#SignalCli-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;stopping signal-cli&quot;</span><span class="p">)</span>
</span><span id="SignalCli-421"><a href="#SignalCli-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>  <span class="c1"># Kill the process (Sends SigTerm)</span>
</span><span id="SignalCli-422"><a href="#SignalCli-422"><span class="linenos">422</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Flushing pipes.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-423"><a href="#SignalCli-423"><span class="linenos">423</span></a>            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>  <span class="c1"># Flush the pipes.</span>
</span><span id="SignalCli-424"><a href="#SignalCli-424"><span class="linenos">424</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDOUT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
</span><span id="SignalCli-425"><a href="#SignalCli-425"><span class="linenos">425</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDERR: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
</span><span id="SignalCli-426"><a href="#SignalCli-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Clear the process.</span>
</span><span id="SignalCli-427"><a href="#SignalCli-427"><span class="linenos">427</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-428"><a href="#SignalCli-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped&quot;</span><span class="p">)</span>
</span><span id="SignalCli-429"><a href="#SignalCli-429"><span class="linenos">429</span></a>
</span><span id="SignalCli-430"><a href="#SignalCli-430"><span class="linenos">430</span></a>        <span class="c1"># Remove socket file:</span>
</span><span id="SignalCli-431"><a href="#SignalCli-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-432"><a href="#SignalCli-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__remove_socket_file__</span><span class="p">()</span>
</span><span id="SignalCli-433"><a href="#SignalCli-433"><span class="linenos">433</span></a>        <span class="k">return</span>
</span><span id="SignalCli-434"><a href="#SignalCli-434"><span class="linenos">434</span></a>
</span><span id="SignalCli-435"><a href="#SignalCli-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">register_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli-436"><a href="#SignalCli-436"><span class="linenos">436</span></a>                         <span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SignalCli-437"><a href="#SignalCli-437"><span class="linenos">437</span></a>                         <span class="n">captcha</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SignalCli-438"><a href="#SignalCli-438"><span class="linenos">438</span></a>                         <span class="n">voice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SignalCli-439"><a href="#SignalCli-439"><span class="linenos">439</span></a>                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SignalCli-440"><a href="#SignalCli-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-441"><a href="#SignalCli-441"><span class="linenos">441</span></a><span class="sd">                Register a new account. NOTE: Subject to rate limiting.</span>
</span><span id="SignalCli-442"><a href="#SignalCli-442"><span class="linenos">442</span></a><span class="sd">                :param number: str: The phone number to register.</span>
</span><span id="SignalCli-443"><a href="#SignalCli-443"><span class="linenos">443</span></a><span class="sd">                :param captcha: str: The captcha from &#39;https://signalcaptchas.org/registration/generate.html&#39;, can</span>
</span><span id="SignalCli-444"><a href="#SignalCli-444"><span class="linenos">444</span></a><span class="sd">                                        include the &#39;signalcaptcha://&#39;.</span>
</span><span id="SignalCli-445"><a href="#SignalCli-445"><span class="linenos">445</span></a><span class="sd">                :param voice: bool: True = Voice call verification, False = SMS verification.</span>
</span><span id="SignalCli-446"><a href="#SignalCli-446"><span class="linenos">446</span></a><span class="sd">                :returns: tuple[bool, Account | str]: The first element (bool) is True for success or failure.  The</span>
</span><span id="SignalCli-447"><a href="#SignalCli-447"><span class="linenos">447</span></a><span class="sd">                                                        second element on success is the new Account object, which</span>
</span><span id="SignalCli-448"><a href="#SignalCli-448"><span class="linenos">448</span></a><span class="sd">                                                        will remain in an unregistered state until verify is called</span>
</span><span id="SignalCli-449"><a href="#SignalCli-449"><span class="linenos">449</span></a><span class="sd">                                                        with the verification code.  Upon failure, the second element</span>
</span><span id="SignalCli-450"><a href="#SignalCli-450"><span class="linenos">450</span></a><span class="sd">                                                        will contain a string with an error message.</span>
</span><span id="SignalCli-451"><a href="#SignalCli-451"><span class="linenos">451</span></a><span class="sd">                :raises: TypeError: If number or captcha are not strings, or if voice is not a boolean.</span>
</span><span id="SignalCli-452"><a href="#SignalCli-452"><span class="linenos">452</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="SignalCli-453"><a href="#SignalCli-453"><span class="linenos">453</span></a>        <span class="c1"># Log started:</span>
</span><span id="SignalCli-454"><a href="#SignalCli-454"><span class="linenos">454</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_account</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-455"><a href="#SignalCli-455"><span class="linenos">455</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Register started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-456"><a href="#SignalCli-456"><span class="linenos">456</span></a>
</span><span id="SignalCli-457"><a href="#SignalCli-457"><span class="linenos">457</span></a>        <span class="c1"># Type check arguments:</span>
</span><span id="SignalCli-458"><a href="#SignalCli-458"><span class="linenos">458</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-459"><a href="#SignalCli-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-460"><a href="#SignalCli-460"><span class="linenos">460</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: number is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="SignalCli-461"><a href="#SignalCli-461"><span class="linenos">461</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
</span><span id="SignalCli-462"><a href="#SignalCli-462"><span class="linenos">462</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli-463"><a href="#SignalCli-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">captcha</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-464"><a href="#SignalCli-464"><span class="linenos">464</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: captcha is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="SignalCli-465"><a href="#SignalCli-465"><span class="linenos">465</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">captcha</span><span class="p">)))</span>
</span><span id="SignalCli-466"><a href="#SignalCli-466"><span class="linenos">466</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;captcha&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">captcha</span><span class="p">)</span>
</span><span id="SignalCli-467"><a href="#SignalCli-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli-468"><a href="#SignalCli-468"><span class="linenos">468</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: voice is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;bool&#39;.&quot;</span>
</span><span id="SignalCli-469"><a href="#SignalCli-469"><span class="linenos">469</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">voice</span><span class="p">)))</span>
</span><span id="SignalCli-470"><a href="#SignalCli-470"><span class="linenos">470</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;voice&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">voice</span><span class="p">)</span>
</span><span id="SignalCli-471"><a href="#SignalCli-471"><span class="linenos">471</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks passed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-472"><a href="#SignalCli-472"><span class="linenos">472</span></a>        <span class="c1"># Value Check arguments:</span>
</span><span id="SignalCli-473"><a href="#SignalCli-473"><span class="linenos">473</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Value checks.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-474"><a href="#SignalCli-474"><span class="linenos">474</span></a>        <span class="n">number_match</span> <span class="o">=</span> <span class="n">phone_number_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli-475"><a href="#SignalCli-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">number_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-476"><a href="#SignalCli-476"><span class="linenos">476</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;number must be in format +nnnnnnnn....&quot;</span>
</span><span id="SignalCli-477"><a href="#SignalCli-477"><span class="linenos">477</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-478"><a href="#SignalCli-478"><span class="linenos">478</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli-479"><a href="#SignalCli-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signalcaptcha://&#39;</span><span class="p">):</span>
</span><span id="SignalCli-480"><a href="#SignalCli-480"><span class="linenos">480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stripping signalcaptcha:// from captcha.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-481"><a href="#SignalCli-481"><span class="linenos">481</span></a>            <span class="n">captcha</span> <span class="o">=</span> <span class="n">captcha</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span><span id="SignalCli-482"><a href="#SignalCli-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-recaptcha-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-hcaptcha&#39;</span><span class="p">):</span>
</span><span id="SignalCli-483"><a href="#SignalCli-483"><span class="linenos">483</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid captcha.&quot;</span>
</span><span id="SignalCli-484"><a href="#SignalCli-484"><span class="linenos">484</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-485"><a href="#SignalCli-485"><span class="linenos">485</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli-486"><a href="#SignalCli-486"><span class="linenos">486</span></a>        <span class="c1"># Check if the account exists, and isn&#39;t registered.</span>
</span><span id="SignalCli-487"><a href="#SignalCli-487"><span class="linenos">487</span></a>        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">get_by_number</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli-488"><a href="#SignalCli-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-489"><a href="#SignalCli-489"><span class="linenos">489</span></a>            <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">registered</span><span class="p">:</span>
</span><span id="SignalCli-490"><a href="#SignalCli-490"><span class="linenos">490</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Account already registered.&quot;</span>
</span><span id="SignalCli-491"><a href="#SignalCli-491"><span class="linenos">491</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-492"><a href="#SignalCli-492"><span class="linenos">492</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli-493"><a href="#SignalCli-493"><span class="linenos">493</span></a>        <span class="c1"># Create register account command object and json command string:</span>
</span><span id="SignalCli-494"><a href="#SignalCli-494"><span class="linenos">494</span></a>        <span class="n">register_account_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli-495"><a href="#SignalCli-495"><span class="linenos">495</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli-496"><a href="#SignalCli-496"><span class="linenos">496</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli-497"><a href="#SignalCli-497"><span class="linenos">497</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span>
</span><span id="SignalCli-498"><a href="#SignalCli-498"><span class="linenos">498</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli-499"><a href="#SignalCli-499"><span class="linenos">499</span></a>                <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
</span><span id="SignalCli-500"><a href="#SignalCli-500"><span class="linenos">500</span></a>                <span class="s2">&quot;captcha&quot;</span><span class="p">:</span> <span class="n">captcha</span><span class="p">,</span>
</span><span id="SignalCli-501"><a href="#SignalCli-501"><span class="linenos">501</span></a>                <span class="s2">&quot;voice&quot;</span><span class="p">:</span> <span class="n">voice</span><span class="p">,</span>
</span><span id="SignalCli-502"><a href="#SignalCli-502"><span class="linenos">502</span></a>            <span class="p">}</span>
</span><span id="SignalCli-503"><a href="#SignalCli-503"><span class="linenos">503</span></a>        <span class="p">}</span>
</span><span id="SignalCli-504"><a href="#SignalCli-504"><span class="linenos">504</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">register_account_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli-505"><a href="#SignalCli-505"><span class="linenos">505</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli-506"><a href="#SignalCli-506"><span class="linenos">506</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli-507"><a href="#SignalCli-507"><span class="linenos">507</span></a>        <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>
</span><span id="SignalCli-508"><a href="#SignalCli-508"><span class="linenos">508</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli-509"><a href="#SignalCli-509"><span class="linenos">509</span></a>        <span class="c1"># TODO: Fix error checking:</span>
</span><span id="SignalCli-510"><a href="#SignalCli-510"><span class="linenos">510</span></a>        <span class="c1"># Check for error:</span>
</span><span id="SignalCli-511"><a href="#SignalCli-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SignalCli-512"><a href="#SignalCli-512"><span class="linenos">512</span></a>            <span class="c1"># Delete local account data, since signal-cli creates data for the account.</span>
</span><span id="SignalCli-513"><a href="#SignalCli-513"><span class="linenos">513</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting incomplete account.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-514"><a href="#SignalCli-514"><span class="linenos">514</span></a>            <span class="n">delete_local_data_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli-515"><a href="#SignalCli-515"><span class="linenos">515</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli-516"><a href="#SignalCli-516"><span class="linenos">516</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SignalCli-517"><a href="#SignalCli-517"><span class="linenos">517</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;deleteLocalAccountData&quot;</span><span class="p">,</span>
</span><span id="SignalCli-518"><a href="#SignalCli-518"><span class="linenos">518</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli-519"><a href="#SignalCli-519"><span class="linenos">519</span></a>                    <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span>
</span><span id="SignalCli-520"><a href="#SignalCli-520"><span class="linenos">520</span></a>                <span class="p">}</span>
</span><span id="SignalCli-521"><a href="#SignalCli-521"><span class="linenos">521</span></a>            <span class="p">}</span>
</span><span id="SignalCli-522"><a href="#SignalCli-522"><span class="linenos">522</span></a>            <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">delete_local_data_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli-523"><a href="#SignalCli-523"><span class="linenos">523</span></a>            <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli-524"><a href="#SignalCli-524"><span class="linenos">524</span></a>            <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli-525"><a href="#SignalCli-525"><span class="linenos">525</span></a>            <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>  <span class="c1"># output unused, we don&#39;t care if it failed.</span>
</span><span id="SignalCli-526"><a href="#SignalCli-526"><span class="linenos">526</span></a>            <span class="c1"># TODO: Error check delete request response and at least warn about it.</span>
</span><span id="SignalCli-527"><a href="#SignalCli-527"><span class="linenos">527</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delete account response: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli-528"><a href="#SignalCli-528"><span class="linenos">528</span></a>            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Signal error, code: </span><span class="si">%i</span><span class="s2">, message: </span><span class="si">%s</span><span class="s2">&quot;</span> \
</span><span id="SignalCli-529"><a href="#SignalCli-529"><span class="linenos">529</span></a>                            <span class="o">%</span> <span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
</span><span id="SignalCli-530"><a href="#SignalCli-530"><span class="linenos">530</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Raising SignalError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-531"><a href="#SignalCli-531"><span class="linenos">531</span></a>            <span class="k">raise</span> <span class="n">SignalError</span><span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-532"><a href="#SignalCli-532"><span class="linenos">532</span></a>
</span><span id="SignalCli-533"><a href="#SignalCli-533"><span class="linenos">533</span></a>        <span class="c1"># No error found, get the new account:</span>
</span><span id="SignalCli-534"><a href="#SignalCli-534"><span class="linenos">534</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Registration successful, syncing accounts with disk...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-535"><a href="#SignalCli-535"><span class="linenos">535</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="SignalCli-536"><a href="#SignalCli-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SignalCli-537"><a href="#SignalCli-537"><span class="linenos">537</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="SignalCli-538"><a href="#SignalCli-538"><span class="linenos">538</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-539"><a href="#SignalCli-539"><span class="linenos">539</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-540"><a href="#SignalCli-540"><span class="linenos">540</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Account registered. Don&#39;t forget to verify.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-541"><a href="#SignalCli-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SignalCli-542"><a href="#SignalCli-542"><span class="linenos">542</span></a>
</span><span id="SignalCli-543"><a href="#SignalCli-543"><span class="linenos">543</span></a>    <span class="k">def</span> <span class="nf">start_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli-544"><a href="#SignalCli-544"><span class="linenos">544</span></a>                   <span class="n">gen_text_qr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SignalCli-545"><a href="#SignalCli-545"><span class="linenos">545</span></a>                   <span class="n">png_qr_code_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-546"><a href="#SignalCli-546"><span class="linenos">546</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="SignalCli-547"><a href="#SignalCli-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-548"><a href="#SignalCli-548"><span class="linenos">548</span></a><span class="sd">        Start the link process for linking an existing account.</span>
</span><span id="SignalCli-549"><a href="#SignalCli-549"><span class="linenos">549</span></a><span class="sd">        :param gen_text_qr: bool: True, generate text qr-code, False, do not.</span>
</span><span id="SignalCli-550"><a href="#SignalCli-550"><span class="linenos">550</span></a><span class="sd">        :param png_qr_code_file_path: Optional[str]: The file path to generate the png qr code at, if None, the qr code</span>
</span><span id="SignalCli-551"><a href="#SignalCli-551"><span class="linenos">551</span></a><span class="sd">            is not generated.</span>
</span><span id="SignalCli-552"><a href="#SignalCli-552"><span class="linenos">552</span></a><span class="sd">        :returns: tuple[str, str, str]: The first element is the link url generated by signal.</span>
</span><span id="SignalCli-553"><a href="#SignalCli-553"><span class="linenos">553</span></a><span class="sd">            The second element is a text QR code string, or an empty string if qrencode is not installed.</span>
</span><span id="SignalCli-554"><a href="#SignalCli-554"><span class="linenos">554</span></a><span class="sd">            The third element is a path to a generated png qrencode, or an empty string if qrencode is not installed.</span>
</span><span id="SignalCli-555"><a href="#SignalCli-555"><span class="linenos">555</span></a><span class="sd">        :raises: TypeError: If name is not a string or None.</span>
</span><span id="SignalCli-556"><a href="#SignalCli-556"><span class="linenos">556</span></a><span class="sd">        :raises: LinkInProgress: If a link is already in progress when start_link_account is called a second time and</span>
</span><span id="SignalCli-557"><a href="#SignalCli-557"><span class="linenos">557</span></a><span class="sd">            finish_link has not been called.</span>
</span><span id="SignalCli-558"><a href="#SignalCli-558"><span class="linenos">558</span></a><span class="sd">        :raises InvalidServerResponse: If the signal link doesn&#39;t seem valid.</span>
</span><span id="SignalCli-559"><a href="#SignalCli-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-560"><a href="#SignalCli-560"><span class="linenos">560</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_link</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-561"><a href="#SignalCli-561"><span class="linenos">561</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Staring link process...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-562"><a href="#SignalCli-562"><span class="linenos">562</span></a>
</span><span id="SignalCli-563"><a href="#SignalCli-563"><span class="linenos">563</span></a>        <span class="c1"># Type checks:</span>
</span><span id="SignalCli-564"><a href="#SignalCli-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gen_text_qr</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli-565"><a href="#SignalCli-565"><span class="linenos">565</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-566"><a href="#SignalCli-566"><span class="linenos">566</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">))</span>
</span><span id="SignalCli-567"><a href="#SignalCli-567"><span class="linenos">567</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">)</span>
</span><span id="SignalCli-568"><a href="#SignalCli-568"><span class="linenos">568</span></a>
</span><span id="SignalCli-569"><a href="#SignalCli-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-570"><a href="#SignalCli-570"><span class="linenos">570</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-571"><a href="#SignalCli-571"><span class="linenos">571</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;png_qr_code_file_path&quot;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">))</span>
</span><span id="SignalCli-572"><a href="#SignalCli-572"><span class="linenos">572</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;png_qr_code_file_path&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">)</span>
</span><span id="SignalCli-573"><a href="#SignalCli-573"><span class="linenos">573</span></a>
</span><span id="SignalCli-574"><a href="#SignalCli-574"><span class="linenos">574</span></a>        <span class="c1"># Check for a running link request:</span>
</span><span id="SignalCli-575"><a href="#SignalCli-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-576"><a href="#SignalCli-576"><span class="linenos">576</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkInProgressError().&quot;</span><span class="p">)</span>
</span><span id="SignalCli-577"><a href="#SignalCli-577"><span class="linenos">577</span></a>            <span class="k">raise</span> <span class="n">LinkInProgress</span><span class="p">()</span>
</span><span id="SignalCli-578"><a href="#SignalCli-578"><span class="linenos">578</span></a>
</span><span id="SignalCli-579"><a href="#SignalCli-579"><span class="linenos">579</span></a>        <span class="c1"># Ensure sigal is running:</span>
</span><span id="SignalCli-580"><a href="#SignalCli-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-581"><a href="#SignalCli-581"><span class="linenos">581</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-clil not running&quot;</span>
</span><span id="SignalCli-582"><a href="#SignalCli-582"><span class="linenos">582</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-583"><a href="#SignalCli-583"><span class="linenos">583</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-584"><a href="#SignalCli-584"><span class="linenos">584</span></a>
</span><span id="SignalCli-585"><a href="#SignalCli-585"><span class="linenos">585</span></a>        <span class="c1"># Create link request object:</span>
</span><span id="SignalCli-586"><a href="#SignalCli-586"><span class="linenos">586</span></a>        <span class="n">link_request_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli-587"><a href="#SignalCli-587"><span class="linenos">587</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli-588"><a href="#SignalCli-588"><span class="linenos">588</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli-589"><a href="#SignalCli-589"><span class="linenos">589</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;startLink&quot;</span><span class="p">,</span>
</span><span id="SignalCli-590"><a href="#SignalCli-590"><span class="linenos">590</span></a>        <span class="p">}</span>
</span><span id="SignalCli-591"><a href="#SignalCli-591"><span class="linenos">591</span></a>
</span><span id="SignalCli-592"><a href="#SignalCli-592"><span class="linenos">592</span></a>        <span class="c1"># Create json command string:</span>
</span><span id="SignalCli-593"><a href="#SignalCli-593"><span class="linenos">593</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_request_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli-594"><a href="#SignalCli-594"><span class="linenos">594</span></a>
</span><span id="SignalCli-595"><a href="#SignalCli-595"><span class="linenos">595</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli-596"><a href="#SignalCli-596"><span class="linenos">596</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli-597"><a href="#SignalCli-597"><span class="linenos">597</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="SignalCli-598"><a href="#SignalCli-598"><span class="linenos">598</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli-599"><a href="#SignalCli-599"><span class="linenos">599</span></a>        <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">)</span>
</span><span id="SignalCli-600"><a href="#SignalCli-600"><span class="linenos">600</span></a>
</span><span id="SignalCli-601"><a href="#SignalCli-601"><span class="linenos">601</span></a>        <span class="c1"># Gather the link from response obj:</span>
</span><span id="SignalCli-602"><a href="#SignalCli-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;deviceLinkUri&#39;</span><span class="p">]</span>
</span><span id="SignalCli-603"><a href="#SignalCli-603"><span class="linenos">603</span></a>
</span><span id="SignalCli-604"><a href="#SignalCli-604"><span class="linenos">604</span></a>        <span class="c1"># Generate text qrcode:</span>
</span><span id="SignalCli-605"><a href="#SignalCli-605"><span class="linenos">605</span></a>        <span class="n">text_qr_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-606"><a href="#SignalCli-606"><span class="linenos">606</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gen_text_qr</span><span class="p">:</span>
</span><span id="SignalCli-607"><a href="#SignalCli-607"><span class="linenos">607</span></a>            <span class="n">command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--type=UTF8&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">]</span>
</span><span id="SignalCli-608"><a href="#SignalCli-608"><span class="linenos">608</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate UTF8 QR-Code...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-609"><a href="#SignalCli-609"><span class="linenos">609</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-610"><a href="#SignalCli-610"><span class="linenos">610</span></a>                <span class="n">bytes_text_qr_code</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">command_line</span><span class="p">)</span>
</span><span id="SignalCli-611"><a href="#SignalCli-611"><span class="linenos">611</span></a>                <span class="n">text_qr_code</span> <span class="o">=</span> <span class="n">bytes_text_qr_code</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF8&#39;</span><span class="p">)</span>
</span><span id="SignalCli-612"><a href="#SignalCli-612"><span class="linenos">612</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;UTF8 QR-Code successfully created.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-613"><a href="#SignalCli-613"><span class="linenos">613</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="SignalCli-614"><a href="#SignalCli-614"><span class="linenos">614</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate UTF8 QR-Code.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-615"><a href="#SignalCli-615"><span class="linenos">615</span></a>
</span><span id="SignalCli-616"><a href="#SignalCli-616"><span class="linenos">616</span></a>        <span class="c1"># Generate png qrcode:</span>
</span><span id="SignalCli-617"><a href="#SignalCli-617"><span class="linenos">617</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-618"><a href="#SignalCli-618"><span class="linenos">618</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate png QR-Code...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-619"><a href="#SignalCli-619"><span class="linenos">619</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-620"><a href="#SignalCli-620"><span class="linenos">620</span></a>                <span class="n">check_call</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">])</span>
</span><span id="SignalCli-621"><a href="#SignalCli-621"><span class="linenos">621</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;png QR-Code successfully generated.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-622"><a href="#SignalCli-622"><span class="linenos">622</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="SignalCli-623"><a href="#SignalCli-623"><span class="linenos">623</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate png QR-Code.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-624"><a href="#SignalCli-624"><span class="linenos">624</span></a>
</span><span id="SignalCli-625"><a href="#SignalCli-625"><span class="linenos">625</span></a>        <span class="c1"># Linking started successfully:</span>
</span><span id="SignalCli-626"><a href="#SignalCli-626"><span class="linenos">626</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Link process successfully started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-627"><a href="#SignalCli-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span> <span class="n">text_qr_code</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span>
</span><span id="SignalCli-628"><a href="#SignalCli-628"><span class="linenos">628</span></a>
</span><span id="SignalCli-629"><a href="#SignalCli-629"><span class="linenos">629</span></a>    <span class="k">def</span> <span class="nf">finish_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SignalCli-630"><a href="#SignalCli-630"><span class="linenos">630</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-631"><a href="#SignalCli-631"><span class="linenos">631</span></a><span class="sd">        Finish the linking process after confirming the link on the primary device.</span>
</span><span id="SignalCli-632"><a href="#SignalCli-632"><span class="linenos">632</span></a><span class="sd">        :param device_name: Optional[str]: The device name to give this link.</span>
</span><span id="SignalCli-633"><a href="#SignalCli-633"><span class="linenos">633</span></a><span class="sd">        :returns: tuple[bool, Account | str]: The first element is a bool representing success or failure; The second</span>
</span><span id="SignalCli-634"><a href="#SignalCli-634"><span class="linenos">634</span></a><span class="sd">                                                element on success will be the new Account object, or on failure will be</span>
</span><span id="SignalCli-635"><a href="#SignalCli-635"><span class="linenos">635</span></a><span class="sd">                                                a string containing an error message.</span>
</span><span id="SignalCli-636"><a href="#SignalCli-636"><span class="linenos">636</span></a><span class="sd">        :raises LinkNotStarted: If the link process hasn&#39;t been started yet.</span>
</span><span id="SignalCli-637"><a href="#SignalCli-637"><span class="linenos">637</span></a><span class="sd">        :raises InvalidServerResponse: If the signal success code is not recognized.</span>
</span><span id="SignalCli-638"><a href="#SignalCli-638"><span class="linenos">638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-639"><a href="#SignalCli-639"><span class="linenos">639</span></a>        <span class="n">logger_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_link</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="SignalCli-640"><a href="#SignalCli-640"><span class="linenos">640</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="SignalCli-641"><a href="#SignalCli-641"><span class="linenos">641</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finish link process started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-642"><a href="#SignalCli-642"><span class="linenos">642</span></a>
</span><span id="SignalCli-643"><a href="#SignalCli-643"><span class="linenos">643</span></a>        <span class="c1"># Type check name:</span>
</span><span id="SignalCli-644"><a href="#SignalCli-644"><span class="linenos">644</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli-645"><a href="#SignalCli-645"><span class="linenos">645</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-646"><a href="#SignalCli-646"><span class="linenos">646</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;device_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">))</span>
</span><span id="SignalCli-647"><a href="#SignalCli-647"><span class="linenos">647</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;device_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[str]&quot;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">)</span>
</span><span id="SignalCli-648"><a href="#SignalCli-648"><span class="linenos">648</span></a>
</span><span id="SignalCli-649"><a href="#SignalCli-649"><span class="linenos">649</span></a>        <span class="c1"># Check for a link process:</span>
</span><span id="SignalCli-650"><a href="#SignalCli-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-651"><a href="#SignalCli-651"><span class="linenos">651</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkNotStarted().&quot;</span><span class="p">)</span>
</span><span id="SignalCli-652"><a href="#SignalCli-652"><span class="linenos">652</span></a>            <span class="k">raise</span> <span class="n">LinkNotStarted</span><span class="p">()</span>
</span><span id="SignalCli-653"><a href="#SignalCli-653"><span class="linenos">653</span></a>
</span><span id="SignalCli-654"><a href="#SignalCli-654"><span class="linenos">654</span></a>        <span class="c1"># Check for running signal-cli:</span>
</span><span id="SignalCli-655"><a href="#SignalCli-655"><span class="linenos">655</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-656"><a href="#SignalCli-656"><span class="linenos">656</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-cli not running&quot;</span>
</span><span id="SignalCli-657"><a href="#SignalCli-657"><span class="linenos">657</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-658"><a href="#SignalCli-658"><span class="linenos">658</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-659"><a href="#SignalCli-659"><span class="linenos">659</span></a>
</span><span id="SignalCli-660"><a href="#SignalCli-660"><span class="linenos">660</span></a>        <span class="c1"># Generate the finishLink command object:</span>
</span><span id="SignalCli-661"><a href="#SignalCli-661"><span class="linenos">661</span></a>        <span class="n">link_finish_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli-662"><a href="#SignalCli-662"><span class="linenos">662</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli-663"><a href="#SignalCli-663"><span class="linenos">663</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli-664"><a href="#SignalCli-664"><span class="linenos">664</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;finishLink&quot;</span><span class="p">,</span>
</span><span id="SignalCli-665"><a href="#SignalCli-665"><span class="linenos">665</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli-666"><a href="#SignalCli-666"><span class="linenos">666</span></a>                <span class="s2">&quot;deviceLinkUri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span>
</span><span id="SignalCli-667"><a href="#SignalCli-667"><span class="linenos">667</span></a>            <span class="p">}</span>
</span><span id="SignalCli-668"><a href="#SignalCli-668"><span class="linenos">668</span></a>        <span class="p">}</span>
</span><span id="SignalCli-669"><a href="#SignalCli-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-670"><a href="#SignalCli-670"><span class="linenos">670</span></a>            <span class="n">link_finish_command_obj</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;deviceName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
</span><span id="SignalCli-671"><a href="#SignalCli-671"><span class="linenos">671</span></a>
</span><span id="SignalCli-672"><a href="#SignalCli-672"><span class="linenos">672</span></a>        <span class="c1"># Generate json command string:</span>
</span><span id="SignalCli-673"><a href="#SignalCli-673"><span class="linenos">673</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_finish_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli-674"><a href="#SignalCli-674"><span class="linenos">674</span></a>
</span><span id="SignalCli-675"><a href="#SignalCli-675"><span class="linenos">675</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli-676"><a href="#SignalCli-676"><span class="linenos">676</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli-677"><a href="#SignalCli-677"><span class="linenos">677</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="SignalCli-678"><a href="#SignalCli-678"><span class="linenos">678</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>  <span class="c1"># Raises Invalid server response</span>
</span><span id="SignalCli-679"><a href="#SignalCli-679"><span class="linenos">679</span></a>
</span><span id="SignalCli-680"><a href="#SignalCli-680"><span class="linenos">680</span></a>        <span class="c1"># Check for error:</span>
</span><span id="SignalCli-681"><a href="#SignalCli-681"><span class="linenos">681</span></a>        <span class="n">error_occurred</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span> <span class="o">=</span> <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</span><span id="SignalCli-682"><a href="#SignalCli-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="n">error_occurred</span><span class="p">:</span>
</span><span id="SignalCli-683"><a href="#SignalCli-683"><span class="linenos">683</span></a>            <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># User already exists:</span>
</span><span id="SignalCli-684"><a href="#SignalCli-684"><span class="linenos">684</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;user already exists&quot;</span>
</span><span id="SignalCli-685"><a href="#SignalCli-685"><span class="linenos">685</span></a>            <span class="k">elif</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>  <span class="c1"># Timeout</span>
</span><span id="SignalCli-686"><a href="#SignalCli-686"><span class="linenos">686</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span>
</span><span id="SignalCli-687"><a href="#SignalCli-687"><span class="linenos">687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli-688"><a href="#SignalCli-688"><span class="linenos">688</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Unhandled non-fatal error. Code </span><span class="si">%i</span><span class="s2">, Message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-689"><a href="#SignalCli-689"><span class="linenos">689</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-690"><a href="#SignalCli-690"><span class="linenos">690</span></a>
</span><span id="SignalCli-691"><a href="#SignalCli-691"><span class="linenos">691</span></a>        <span class="c1"># Gather linked number from response:</span>
</span><span id="SignalCli-692"><a href="#SignalCli-692"><span class="linenos">692</span></a>        <span class="n">linked_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
</span><span id="SignalCli-693"><a href="#SignalCli-693"><span class="linenos">693</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Link successful for account: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">linked_number</span><span class="p">)</span>
</span><span id="SignalCli-694"><a href="#SignalCli-694"><span class="linenos">694</span></a>
</span><span id="SignalCli-695"><a href="#SignalCli-695"><span class="linenos">695</span></a>        <span class="c1"># Sync accounts and get the new account:</span>
</span><span id="SignalCli-696"><a href="#SignalCli-696"><span class="linenos">696</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Syncing accounts with disk.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-697"><a href="#SignalCli-697"><span class="linenos">697</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="SignalCli-698"><a href="#SignalCli-698"><span class="linenos">698</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SignalCli-699"><a href="#SignalCli-699"><span class="linenos">699</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="SignalCli-700"><a href="#SignalCli-700"><span class="linenos">700</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-701"><a href="#SignalCli-701"><span class="linenos">701</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli-702"><a href="#SignalCli-702"><span class="linenos">702</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-703"><a href="#SignalCli-703"><span class="linenos">703</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SignalCli-704"><a href="#SignalCli-704"><span class="linenos">704</span></a>
</span><span id="SignalCli-705"><a href="#SignalCli-705"><span class="linenos">705</span></a>    <span class="k">def</span> <span class="nf">start_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli-706"><a href="#SignalCli-706"><span class="linenos">706</span></a>                      <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">,</span>
</span><span id="SignalCli-707"><a href="#SignalCli-707"><span class="linenos">707</span></a>                      <span class="n">all_messages_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-708"><a href="#SignalCli-708"><span class="linenos">708</span></a>                      <span class="n">received_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-709"><a href="#SignalCli-709"><span class="linenos">709</span></a>                      <span class="n">receipt_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-710"><a href="#SignalCli-710"><span class="linenos">710</span></a>                      <span class="n">sync_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-711"><a href="#SignalCli-711"><span class="linenos">711</span></a>                      <span class="n">typing_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-712"><a href="#SignalCli-712"><span class="linenos">712</span></a>                      <span class="n">story_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-713"><a href="#SignalCli-713"><span class="linenos">713</span></a>                      <span class="n">payment_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-714"><a href="#SignalCli-714"><span class="linenos">714</span></a>                      <span class="n">reaction_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-715"><a href="#SignalCli-715"><span class="linenos">715</span></a>                      <span class="n">call_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli-716"><a href="#SignalCli-716"><span class="linenos">716</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli-717"><a href="#SignalCli-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-718"><a href="#SignalCli-718"><span class="linenos">718</span></a><span class="sd">        Start receiving messages for the given account.</span>
</span><span id="SignalCli-719"><a href="#SignalCli-719"><span class="linenos">719</span></a><span class="sd">        NOTE: Callback signature is (account: Account, message: Message)</span>
</span><span id="SignalCli-720"><a href="#SignalCli-720"><span class="linenos">720</span></a><span class="sd">        :param account: Account: The account to receive messages for.</span>
</span><span id="SignalCli-721"><a href="#SignalCli-721"><span class="linenos">721</span></a><span class="sd">        :param all_messages_callback: Optional[Callable]: Callback for all messages received.</span>
</span><span id="SignalCli-722"><a href="#SignalCli-722"><span class="linenos">722</span></a><span class="sd">        :param received_message_callback: Optional[Callable]: Callback for received messages. (regular message)</span>
</span><span id="SignalCli-723"><a href="#SignalCli-723"><span class="linenos">723</span></a><span class="sd">        :param receipt_message_callback: Optional[Callable]: Callback for receipt messages.</span>
</span><span id="SignalCli-724"><a href="#SignalCli-724"><span class="linenos">724</span></a><span class="sd">        :param sync_message_callback: Optional[Callable]: Callback for sync messages.</span>
</span><span id="SignalCli-725"><a href="#SignalCli-725"><span class="linenos">725</span></a><span class="sd">        :param typing_message_callback: Optional[Callable]: Callback for typing messages.</span>
</span><span id="SignalCli-726"><a href="#SignalCli-726"><span class="linenos">726</span></a><span class="sd">        :param story_message_callback: Optional[Callable]: Callback for story messages.</span>
</span><span id="SignalCli-727"><a href="#SignalCli-727"><span class="linenos">727</span></a><span class="sd">        :param payment_message_callback: Optional[Callable]: Callback for payment messages.</span>
</span><span id="SignalCli-728"><a href="#SignalCli-728"><span class="linenos">728</span></a><span class="sd">        :param reaction_message_callback: Optional[Callable]: Callback for reaction messages.</span>
</span><span id="SignalCli-729"><a href="#SignalCli-729"><span class="linenos">729</span></a><span class="sd">        :param call_message_callback: Optional[Callable]: Callback for incoming call messages.</span>
</span><span id="SignalCli-730"><a href="#SignalCli-730"><span class="linenos">730</span></a><span class="sd">        :returns: None</span>
</span><span id="SignalCli-731"><a href="#SignalCli-731"><span class="linenos">731</span></a><span class="sd">        :raises: TypeError: If the account is not an Account object, or if a callback is defined, but not callable.</span>
</span><span id="SignalCli-732"><a href="#SignalCli-732"><span class="linenos">732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-733"><a href="#SignalCli-733"><span class="linenos">733</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-734"><a href="#SignalCli-734"><span class="linenos">734</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start receive started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-735"><a href="#SignalCli-735"><span class="linenos">735</span></a>        <span class="c1"># Argument checks NOTE: ReceiveThread type checks callbacks:</span>
</span><span id="SignalCli-736"><a href="#SignalCli-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="SignalCli-737"><a href="#SignalCli-737"><span class="linenos">737</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-738"><a href="#SignalCli-738"><span class="linenos">738</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="SignalCli-739"><a href="#SignalCli-739"><span class="linenos">739</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="SignalCli-740"><a href="#SignalCli-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="n">all_messages_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">all_messages_callback</span><span class="p">):</span>
</span><span id="SignalCli-741"><a href="#SignalCli-741"><span class="linenos">741</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-742"><a href="#SignalCli-742"><span class="linenos">742</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">))</span>
</span><span id="SignalCli-743"><a href="#SignalCli-743"><span class="linenos">743</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">)</span>
</span><span id="SignalCli-744"><a href="#SignalCli-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="n">received_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">received_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-745"><a href="#SignalCli-745"><span class="linenos">745</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-746"><a href="#SignalCli-746"><span class="linenos">746</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli-747"><a href="#SignalCli-747"><span class="linenos">747</span></a>                                             <span class="n">received_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-748"><a href="#SignalCli-748"><span class="linenos">748</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">received_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-749"><a href="#SignalCli-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="n">receipt_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">receipt_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-750"><a href="#SignalCli-750"><span class="linenos">750</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-751"><a href="#SignalCli-751"><span class="linenos">751</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span>
</span><span id="SignalCli-752"><a href="#SignalCli-752"><span class="linenos">752</span></a>                                             <span class="n">receipt_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-753"><a href="#SignalCli-753"><span class="linenos">753</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">receipt_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-754"><a href="#SignalCli-754"><span class="linenos">754</span></a>        <span class="k">if</span> <span class="n">sync_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">sync_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-755"><a href="#SignalCli-755"><span class="linenos">755</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-756"><a href="#SignalCli-756"><span class="linenos">756</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-757"><a href="#SignalCli-757"><span class="linenos">757</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-758"><a href="#SignalCli-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="n">typing_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">typing_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-759"><a href="#SignalCli-759"><span class="linenos">759</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-760"><a href="#SignalCli-760"><span class="linenos">760</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli-761"><a href="#SignalCli-761"><span class="linenos">761</span></a>                                             <span class="n">typing_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-762"><a href="#SignalCli-762"><span class="linenos">762</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">typing_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-763"><a href="#SignalCli-763"><span class="linenos">763</span></a>        <span class="k">if</span> <span class="n">story_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">story_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-764"><a href="#SignalCli-764"><span class="linenos">764</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-765"><a href="#SignalCli-765"><span class="linenos">765</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;story_message_callback&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[Callable]&quot;</span><span class="p">,</span>
</span><span id="SignalCli-766"><a href="#SignalCli-766"><span class="linenos">766</span></a>                                             <span class="n">story_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-767"><a href="#SignalCli-767"><span class="linenos">767</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;story_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">story_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-768"><a href="#SignalCli-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="n">payment_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">payment_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-769"><a href="#SignalCli-769"><span class="linenos">769</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-770"><a href="#SignalCli-770"><span class="linenos">770</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli-771"><a href="#SignalCli-771"><span class="linenos">771</span></a>                                             <span class="n">payment_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-772"><a href="#SignalCli-772"><span class="linenos">772</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">payment_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-773"><a href="#SignalCli-773"><span class="linenos">773</span></a>        <span class="k">if</span> <span class="n">reaction_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">reaction_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-774"><a href="#SignalCli-774"><span class="linenos">774</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-775"><a href="#SignalCli-775"><span class="linenos">775</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli-776"><a href="#SignalCli-776"><span class="linenos">776</span></a>                                             <span class="n">reaction_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-777"><a href="#SignalCli-777"><span class="linenos">777</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">reaction_message_callback</span><span class="p">)</span>
</span><span id="SignalCli-778"><a href="#SignalCli-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="n">call_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">call_message_callback</span><span class="p">):</span>
</span><span id="SignalCli-779"><a href="#SignalCli-779"><span class="linenos">779</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-780"><a href="#SignalCli-780"><span class="linenos">780</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;call_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">call_message_callback</span><span class="p">))</span>
</span><span id="SignalCli-781"><a href="#SignalCli-781"><span class="linenos">781</span></a>
</span><span id="SignalCli-782"><a href="#SignalCli-782"><span class="linenos">782</span></a>        <span class="c1"># Start receive:</span>
</span><span id="SignalCli-783"><a href="#SignalCli-783"><span class="linenos">783</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="SignalCli-784"><a href="#SignalCli-784"><span class="linenos">784</span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">ReceiveThread</span><span class="p">(</span><span class="n">server_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span>
</span><span id="SignalCli-785"><a href="#SignalCli-785"><span class="linenos">785</span></a>                               <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="SignalCli-786"><a href="#SignalCli-786"><span class="linenos">786</span></a>                               <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span>
</span><span id="SignalCli-787"><a href="#SignalCli-787"><span class="linenos">787</span></a>                               <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="SignalCli-788"><a href="#SignalCli-788"><span class="linenos">788</span></a>                               <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span>
</span><span id="SignalCli-789"><a href="#SignalCli-789"><span class="linenos">789</span></a>                               <span class="n">all_messages_callback</span><span class="o">=</span><span class="n">all_messages_callback</span><span class="p">,</span>
</span><span id="SignalCli-790"><a href="#SignalCli-790"><span class="linenos">790</span></a>                               <span class="n">received_message_callback</span><span class="o">=</span><span class="n">received_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-791"><a href="#SignalCli-791"><span class="linenos">791</span></a>                               <span class="n">receipt_message_callback</span><span class="o">=</span><span class="n">receipt_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-792"><a href="#SignalCli-792"><span class="linenos">792</span></a>                               <span class="n">sync_message_callback</span><span class="o">=</span><span class="n">sync_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-793"><a href="#SignalCli-793"><span class="linenos">793</span></a>                               <span class="n">typing_message_callback</span><span class="o">=</span><span class="n">typing_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-794"><a href="#SignalCli-794"><span class="linenos">794</span></a>                               <span class="n">story_message_callback</span><span class="o">=</span><span class="n">story_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-795"><a href="#SignalCli-795"><span class="linenos">795</span></a>                               <span class="n">payment_message_callback</span><span class="o">=</span><span class="n">payment_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-796"><a href="#SignalCli-796"><span class="linenos">796</span></a>                               <span class="n">reaction_message_callback</span><span class="o">=</span><span class="n">reaction_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-797"><a href="#SignalCli-797"><span class="linenos">797</span></a>                               <span class="n">call_message_callback</span><span class="o">=</span><span class="n">call_message_callback</span><span class="p">,</span>
</span><span id="SignalCli-798"><a href="#SignalCli-798"><span class="linenos">798</span></a>                               <span class="p">)</span>
</span><span id="SignalCli-799"><a href="#SignalCli-799"><span class="linenos">799</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SignalCli-800"><a href="#SignalCli-800"><span class="linenos">800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thread</span>
</span><span id="SignalCli-801"><a href="#SignalCli-801"><span class="linenos">801</span></a>        <span class="k">return</span>
</span><span id="SignalCli-802"><a href="#SignalCli-802"><span class="linenos">802</span></a>
</span><span id="SignalCli-803"><a href="#SignalCli-803"><span class="linenos">803</span></a>    <span class="k">def</span> <span class="nf">stop_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SignalCli-804"><a href="#SignalCli-804"><span class="linenos">804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli-805"><a href="#SignalCli-805"><span class="linenos">805</span></a><span class="sd">        Stop receiving messages for the given account.</span>
</span><span id="SignalCli-806"><a href="#SignalCli-806"><span class="linenos">806</span></a><span class="sd">        :param account: Account: The account to stop reception for.</span>
</span><span id="SignalCli-807"><a href="#SignalCli-807"><span class="linenos">807</span></a><span class="sd">        :returns: bool: True reception successfully stopped, False reception wasn&#39;t started.</span>
</span><span id="SignalCli-808"><a href="#SignalCli-808"><span class="linenos">808</span></a><span class="sd">        :raises: TypeError: If the parameter account is not an Account object.</span>
</span><span id="SignalCli-809"><a href="#SignalCli-809"><span class="linenos">809</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli-810"><a href="#SignalCli-810"><span class="linenos">810</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli-811"><a href="#SignalCli-811"><span class="linenos">811</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping reception thread.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-812"><a href="#SignalCli-812"><span class="linenos">812</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="SignalCli-813"><a href="#SignalCli-813"><span class="linenos">813</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="SignalCli-814"><a href="#SignalCli-814"><span class="linenos">814</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli-815"><a href="#SignalCli-815"><span class="linenos">815</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="SignalCli-816"><a href="#SignalCli-816"><span class="linenos">816</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="SignalCli-817"><a href="#SignalCli-817"><span class="linenos">817</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="SignalCli-818"><a href="#SignalCli-818"><span class="linenos">818</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli-819"><a href="#SignalCli-819"><span class="linenos">819</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching thread: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">thread_id</span><span class="p">)</span>
</span><span id="SignalCli-820"><a href="#SignalCli-820"><span class="linenos">820</span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span>
</span><span id="SignalCli-821"><a href="#SignalCli-821"><span class="linenos">821</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SignalCli-822"><a href="#SignalCli-822"><span class="linenos">822</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread not started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-823"><a href="#SignalCli-823"><span class="linenos">823</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SignalCli-824"><a href="#SignalCli-824"><span class="linenos">824</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stopping thread...&quot;</span><span class="p">)</span>
</span><span id="SignalCli-825"><a href="#SignalCli-825"><span class="linenos">825</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="SignalCli-826"><a href="#SignalCli-826"><span class="linenos">826</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-827"><a href="#SignalCli-827"><span class="linenos">827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli-828"><a href="#SignalCli-828"><span class="linenos">828</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reception stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli-829"><a href="#SignalCli-829"><span class="linenos">829</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Signal cli object.</p>
</div>


                            <div id="SignalCli.__init__" class="classattr">
                                        <input id="SignalCli.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SignalCli</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">signal_config_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">signal_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">server_address</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">start_signal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="SignalCli.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.__init__-25"><a href="#SignalCli.__init__-25"><span class="linenos"> 25</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli.__init__-26"><a href="#SignalCli.__init__-26"><span class="linenos"> 26</span></a>                 <span class="n">signal_config_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.__init__-27"><a href="#SignalCli.__init__-27"><span class="linenos"> 27</span></a>                 <span class="n">signal_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.__init__-28"><a href="#SignalCli.__init__-28"><span class="linenos"> 28</span></a>                 <span class="n">server_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.__init__-29"><a href="#SignalCli.__init__-29"><span class="linenos"> 29</span></a>                 <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.__init__-30"><a href="#SignalCli.__init__-30"><span class="linenos"> 30</span></a>                 <span class="n">start_signal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SignalCli.__init__-31"><a href="#SignalCli.__init__-31"><span class="linenos"> 31</span></a>                 <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.__init__-32"><a href="#SignalCli.__init__-32"><span class="linenos"> 32</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SignalCli.__init__-33"><a href="#SignalCli.__init__-33"><span class="linenos"> 33</span></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-34"><a href="#SignalCli.__init__-34"><span class="linenos"> 34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-35"><a href="#SignalCli.__init__-35"><span class="linenos"> 35</span></a><span class="sd">        Initialize signal-cli, starting the process if required.</span>
</span><span id="SignalCli.__init__-36"><a href="#SignalCli.__init__-36"><span class="linenos"> 36</span></a><span class="sd">        :param signal_config_path: Optional[str]: The path to the directory signal-cli should use.</span>
</span><span id="SignalCli.__init__-37"><a href="#SignalCli.__init__-37"><span class="linenos"> 37</span></a><span class="sd">        :param signal_exec_path: Optional[str]: The path to the signal-cli executable.</span>
</span><span id="SignalCli.__init__-38"><a href="#SignalCli.__init__-38"><span class="linenos"> 38</span></a><span class="sd">        :param server_address: Optional[list[str , int] | tuple[str, int] | str]: If signal-cli is already started,</span>
</span><span id="SignalCli.__init__-39"><a href="#SignalCli.__init__-39"><span class="linenos"> 39</span></a><span class="sd">            the address of the server, if a unix socket, use a str, otherwise use a tuple/list[hostname:str,port:int]</span>
</span><span id="SignalCli.__init__-40"><a href="#SignalCli.__init__-40"><span class="linenos"> 40</span></a><span class="sd">        :param log_file_path: Optional[str]: The path to the signal log file, if None, no logging is preformed.</span>
</span><span id="SignalCli.__init__-41"><a href="#SignalCli.__init__-41"><span class="linenos"> 41</span></a><span class="sd">        :param start_signal: Bool: True = start a signal-cli process, False = signal-cli is already running.</span>
</span><span id="SignalCli.__init__-42"><a href="#SignalCli.__init__-42"><span class="linenos"> 42</span></a><span class="sd">        :param callback: Optional[tuple[Callable, Optional[list[Any]]]]: The call back as a tuple, the first element</span>
</span><span id="SignalCli.__init__-43"><a href="#SignalCli.__init__-43"><span class="linenos"> 43</span></a><span class="sd">            being the callable, and the second element; If not None, is a list of any parameters to provide to the</span>
</span><span id="SignalCli.__init__-44"><a href="#SignalCli.__init__-44"><span class="linenos"> 44</span></a><span class="sd">            callback.  The callback signature is: (status: str, *params)</span>
</span><span id="SignalCli.__init__-45"><a href="#SignalCli.__init__-45"><span class="linenos"> 45</span></a><span class="sd">        :param debug: Bool: Produce debug output on stdout.</span>
</span><span id="SignalCli.__init__-46"><a href="#SignalCli.__init__-46"><span class="linenos"> 46</span></a><span class="sd">        :raises TypeError: If a parameter is of invalid type.</span>
</span><span id="SignalCli.__init__-47"><a href="#SignalCli.__init__-47"><span class="linenos"> 47</span></a><span class="sd">        :raises FileNotFoundError: If a file / directory doesn&#39;t exist when it should.</span>
</span><span id="SignalCli.__init__-48"><a href="#SignalCli.__init__-48"><span class="linenos"> 48</span></a><span class="sd">        :raises FileExistsError: If a socket file exists when it shouldn&#39;t.</span>
</span><span id="SignalCli.__init__-49"><a href="#SignalCli.__init__-49"><span class="linenos"> 49</span></a><span class="sd">        :raises RuntimeError: If an error occurs while loading signal data, more information in the error message.</span>
</span><span id="SignalCli.__init__-50"><a href="#SignalCli.__init__-50"><span class="linenos"> 50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-51"><a href="#SignalCli.__init__-51"><span class="linenos"> 51</span></a>        <span class="c1"># Super:</span>
</span><span id="SignalCli.__init__-52"><a href="#SignalCli.__init__-52"><span class="linenos"> 52</span></a>        <span class="nb">object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SignalCli.__init__-53"><a href="#SignalCli.__init__-53"><span class="linenos"> 53</span></a>
</span><span id="SignalCli.__init__-54"><a href="#SignalCli.__init__-54"><span class="linenos"> 54</span></a>        <span class="c1"># Setup logging.</span>
</span><span id="SignalCli.__init__-55"><a href="#SignalCli.__init__-55"><span class="linenos"> 55</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.__init__-56"><a href="#SignalCli.__init__-56"><span class="linenos"> 56</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialize.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-57"><a href="#SignalCli.__init__-57"><span class="linenos"> 57</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="SignalCli.__init__-58"><a href="#SignalCli.__init__-58"><span class="linenos"> 58</span></a>
</span><span id="SignalCli.__init__-59"><a href="#SignalCli.__init__-59"><span class="linenos"> 59</span></a>        <span class="c1"># Check signal config path:</span>
</span><span id="SignalCli.__init__-60"><a href="#SignalCli.__init__-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-61"><a href="#SignalCli.__init__-61"><span class="linenos"> 61</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-62"><a href="#SignalCli.__init__-62"><span class="linenos"> 62</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-63"><a href="#SignalCli.__init__-63"><span class="linenos"> 63</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_config_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_config_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-64"><a href="#SignalCli.__init__-64"><span class="linenos"> 64</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_config_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-65"><a href="#SignalCli.__init__-65"><span class="linenos"> 65</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_config_path &#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t exist.&quot;</span> <span class="o">%</span> <span class="n">signal_config_path</span>
</span><span id="SignalCli.__init__-66"><a href="#SignalCli.__init__-66"><span class="linenos"> 66</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-67"><a href="#SignalCli.__init__-67"><span class="linenos"> 67</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-68"><a href="#SignalCli.__init__-68"><span class="linenos"> 68</span></a>
</span><span id="SignalCli.__init__-69"><a href="#SignalCli.__init__-69"><span class="linenos"> 69</span></a>        <span class="c1"># Check signal exec path:</span>
</span><span id="SignalCli.__init__-70"><a href="#SignalCli.__init__-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-71"><a href="#SignalCli.__init__-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-72"><a href="#SignalCli.__init__-72"><span class="linenos"> 72</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-73"><a href="#SignalCli.__init__-73"><span class="linenos"> 73</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;signal_exec_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">signal_exec_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-74"><a href="#SignalCli.__init__-74"><span class="linenos"> 74</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">signal_exec_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-75"><a href="#SignalCli.__init__-75"><span class="linenos"> 75</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;signal_exec_path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">signal_exec_path</span>
</span><span id="SignalCli.__init__-76"><a href="#SignalCli.__init__-76"><span class="linenos"> 76</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FileNotFoundError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-77"><a href="#SignalCli.__init__-77"><span class="linenos"> 77</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-78"><a href="#SignalCli.__init__-78"><span class="linenos"> 78</span></a>
</span><span id="SignalCli.__init__-79"><a href="#SignalCli.__init__-79"><span class="linenos"> 79</span></a>        <span class="c1"># Check start signal:</span>
</span><span id="SignalCli.__init__-80"><a href="#SignalCli.__init__-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_signal</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli.__init__-81"><a href="#SignalCli.__init__-81"><span class="linenos"> 81</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-82"><a href="#SignalCli.__init__-82"><span class="linenos"> 82</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;start_signal&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">start_signal</span><span class="p">)</span>
</span><span id="SignalCli.__init__-83"><a href="#SignalCli.__init__-83"><span class="linenos"> 83</span></a>
</span><span id="SignalCli.__init__-84"><a href="#SignalCli.__init__-84"><span class="linenos"> 84</span></a>        <span class="c1"># Check the server address:</span>
</span><span id="SignalCli.__init__-85"><a href="#SignalCli.__init__-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-86"><a href="#SignalCli.__init__-86"><span class="linenos"> 86</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="SignalCli.__init__-87"><a href="#SignalCli.__init__-87"><span class="linenos"> 87</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SignalCli.__init__-88"><a href="#SignalCli.__init__-88"><span class="linenos"> 88</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;server_address must have a length of 2.&quot;</span>
</span><span id="SignalCli.__init__-89"><a href="#SignalCli.__init__-89"><span class="linenos"> 89</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising ValueError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-90"><a href="#SignalCli.__init__-90"><span class="linenos"> 90</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-91"><a href="#SignalCli.__init__-91"><span class="linenos"> 91</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-92"><a href="#SignalCli.__init__-92"><span class="linenos"> 92</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-93"><a href="#SignalCli.__init__-93"><span class="linenos"> 93</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[0]&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SignalCli.__init__-94"><a href="#SignalCli.__init__-94"><span class="linenos"> 94</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="SignalCli.__init__-95"><a href="#SignalCli.__init__-95"><span class="linenos"> 95</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-96"><a href="#SignalCli.__init__-96"><span class="linenos"> 96</span></a>                    <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;server_address[1]&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SignalCli.__init__-97"><a href="#SignalCli.__init__-97"><span class="linenos"> 97</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-98"><a href="#SignalCli.__init__-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-99"><a href="#SignalCli.__init__-99"><span class="linenos"> 99</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; already exists. Perhaps signal is already running.&quot;</span> \
</span><span id="SignalCli.__init__-100"><a href="#SignalCli.__init__-100"><span class="linenos">100</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="SignalCli.__init__-101"><a href="#SignalCli.__init__-101"><span class="linenos">101</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileExistsError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-102"><a href="#SignalCli.__init__-102"><span class="linenos">102</span></a>                    <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-103"><a href="#SignalCli.__init__-103"><span class="linenos">103</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-104"><a href="#SignalCli.__init__-104"><span class="linenos">104</span></a>                    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Socket path &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist. Perhaps signal isn&#39;t running.&quot;</span> \
</span><span id="SignalCli.__init__-105"><a href="#SignalCli.__init__-105"><span class="linenos">105</span></a>                                         <span class="o">%</span> <span class="n">server_address</span>
</span><span id="SignalCli.__init__-106"><a href="#SignalCli.__init__-106"><span class="linenos">106</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising FileNotFoundError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-107"><a href="#SignalCli.__init__-107"><span class="linenos">107</span></a>                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-108"><a href="#SignalCli.__init__-108"><span class="linenos">108</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli.__init__-109"><a href="#SignalCli.__init__-109"><span class="linenos">109</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-110"><a href="#SignalCli.__init__-110"><span class="linenos">110</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;server_address&#39;</span><span class="p">,</span> <span class="s1">&#39;list[str, int] | tuple[str, int] | str&#39;</span><span class="p">,</span> <span class="n">server_address</span><span class="p">)</span>
</span><span id="SignalCli.__init__-111"><a href="#SignalCli.__init__-111"><span class="linenos">111</span></a>
</span><span id="SignalCli.__init__-112"><a href="#SignalCli.__init__-112"><span class="linenos">112</span></a>        <span class="c1"># Check the log file path:</span>
</span><span id="SignalCli.__init__-113"><a href="#SignalCli.__init__-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">log_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-114"><a href="#SignalCli.__init__-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-115"><a href="#SignalCli.__init__-115"><span class="linenos">115</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-116"><a href="#SignalCli.__init__-116"><span class="linenos">116</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;log_file_path&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">log_file_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-117"><a href="#SignalCli.__init__-117"><span class="linenos">117</span></a>
</span><span id="SignalCli.__init__-118"><a href="#SignalCli.__init__-118"><span class="linenos">118</span></a>        <span class="c1"># Check callback:</span>
</span><span id="SignalCli.__init__-119"><a href="#SignalCli.__init__-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-120"><a href="#SignalCli.__init__-120"><span class="linenos">120</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="SignalCli.__init__-121"><a href="#SignalCli.__init__-121"><span class="linenos">121</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-122"><a href="#SignalCli.__init__-122"><span class="linenos">122</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[tuple[Callable, Optional[list[Any]]]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</span><span id="SignalCli.__init__-123"><a href="#SignalCli.__init__-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SignalCli.__init__-124"><a href="#SignalCli.__init__-124"><span class="linenos">124</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;callback must be 2 elements long.&quot;</span>
</span><span id="SignalCli.__init__-125"><a href="#SignalCli.__init__-125"><span class="linenos">125</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-126"><a href="#SignalCli.__init__-126"><span class="linenos">126</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.__init__-127"><a href="#SignalCli.__init__-127"><span class="linenos">127</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">]):</span>
</span><span id="SignalCli.__init__-128"><a href="#SignalCli.__init__-128"><span class="linenos">128</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-129"><a href="#SignalCli.__init__-129"><span class="linenos">129</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[0]&#39;</span><span class="p">,</span> <span class="s1">&#39;Callable&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">CALLABLE</span><span class="p">])</span>
</span><span id="SignalCli.__init__-130"><a href="#SignalCli.__init__-130"><span class="linenos">130</span></a>            <span class="k">elif</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="SignalCli.__init__-131"><a href="#SignalCli.__init__-131"><span class="linenos">131</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-132"><a href="#SignalCli.__init__-132"><span class="linenos">132</span></a>                <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;callback[1]&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[list[Any]]&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">[</span><span class="n">CallbackIdx</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">])</span>
</span><span id="SignalCli.__init__-133"><a href="#SignalCli.__init__-133"><span class="linenos">133</span></a>
</span><span id="SignalCli.__init__-134"><a href="#SignalCli.__init__-134"><span class="linenos">134</span></a>        <span class="c1"># Check debug:</span>
</span><span id="SignalCli.__init__-135"><a href="#SignalCli.__init__-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli.__init__-136"><a href="#SignalCli.__init__-136"><span class="linenos">136</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-137"><a href="#SignalCli.__init__-137"><span class="linenos">137</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="SignalCli.__init__-138"><a href="#SignalCli.__init__-138"><span class="linenos">138</span></a>
</span><span id="SignalCli.__init__-139"><a href="#SignalCli.__init__-139"><span class="linenos">139</span></a>        <span class="c1"># Set internal vars:</span>
</span><span id="SignalCli.__init__-140"><a href="#SignalCli.__init__-140"><span class="linenos">140</span></a>        <span class="c1"># Set the config path:</span>
</span><span id="SignalCli.__init__-141"><a href="#SignalCli.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="SignalCli.__init__-142"><a href="#SignalCli.__init__-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal config directory.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-143"><a href="#SignalCli.__init__-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">signal_config_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-144"><a href="#SignalCli.__init__-144"><span class="linenos">144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">signal_config_path</span>
</span><span id="SignalCli.__init__-145"><a href="#SignalCli.__init__-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli.__init__-146"><a href="#SignalCli.__init__-146"><span class="linenos">146</span></a>            <span class="n">home_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-147"><a href="#SignalCli.__init__-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">home_path</span><span class="p">,</span> <span class="s1">&#39;.local&#39;</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="s1">&#39;signal-cli&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-148"><a href="#SignalCli.__init__-148"><span class="linenos">148</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli config path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-149"><a href="#SignalCli.__init__-149"><span class="linenos">149</span></a>
</span><span id="SignalCli.__init__-150"><a href="#SignalCli.__init__-150"><span class="linenos">150</span></a>        <span class="c1"># Set signal exec path:</span>
</span><span id="SignalCli.__init__-151"><a href="#SignalCli.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signalExecPath</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="SignalCli.__init__-152"><a href="#SignalCli.__init__-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the signal-cli executable.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-153"><a href="#SignalCli.__init__-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">signal_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-154"><a href="#SignalCli.__init__-154"><span class="linenos">154</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to passed parameter.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-155"><a href="#SignalCli.__init__-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">signal_exec_path</span>
</span><span id="SignalCli.__init__-156"><a href="#SignalCli.__init__-156"><span class="linenos">156</span></a>        <span class="k">elif</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-157"><a href="#SignalCli.__init__-157"><span class="linenos">157</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finding signal_exec_path.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-158"><a href="#SignalCli.__init__-158"><span class="linenos">158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="n">__find_signal__</span><span class="p">()</span>  <span class="c1"># Raises FileNotFoundError if signal-cli not found.</span>
</span><span id="SignalCli.__init__-159"><a href="#SignalCli.__init__-159"><span class="linenos">159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli.__init__-160"><a href="#SignalCli.__init__-160"><span class="linenos">160</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting signal_exec_path to None.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-161"><a href="#SignalCli.__init__-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-162"><a href="#SignalCli.__init__-162"><span class="linenos">162</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;signal-cli exec path: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_exec_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-163"><a href="#SignalCli.__init__-163"><span class="linenos">163</span></a>
</span><span id="SignalCli.__init__-164"><a href="#SignalCli.__init__-164"><span class="linenos">164</span></a>        <span class="c1"># Set server address:</span>
</span><span id="SignalCli.__init__-165"><a href="#SignalCli.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
</span><span id="SignalCli.__init__-166"><a href="#SignalCli.__init__-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;The server address of the signal-cli socket.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-167"><a href="#SignalCli.__init__-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">server_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.__init__-168"><a href="#SignalCli.__init__-168"><span class="linenos">168</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Setting server_address from parameter.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-169"><a href="#SignalCli.__init__-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">server_address</span>
</span><span id="SignalCli.__init__-170"><a href="#SignalCli.__init__-170"><span class="linenos">170</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli.__init__-171"><a href="#SignalCli.__init__-171"><span class="linenos">171</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building server_address, selecting UNIX socket.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-172"><a href="#SignalCli.__init__-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-173"><a href="#SignalCli.__init__-173"><span class="linenos">173</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Server address: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">))</span>
</span><span id="SignalCli.__init__-174"><a href="#SignalCli.__init__-174"><span class="linenos">174</span></a>
</span><span id="SignalCli.__init__-175"><a href="#SignalCli.__init__-175"><span class="linenos">175</span></a>        <span class="c1"># Store debug:</span>
</span><span id="SignalCli.__init__-176"><a href="#SignalCli.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="SignalCli.__init__-177"><a href="#SignalCli.__init__-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if we should produce debugging output.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-178"><a href="#SignalCli.__init__-178"><span class="linenos">178</span></a>        <span class="c1"># Store log file path:</span>
</span><span id="SignalCli.__init__-179"><a href="#SignalCli.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_file_path</span>
</span><span id="SignalCli.__init__-180"><a href="#SignalCli.__init__-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The path to the signal-cli log file.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-181"><a href="#SignalCli.__init__-181"><span class="linenos">181</span></a>        <span class="c1"># Store callback:</span>
</span><span id="SignalCli.__init__-182"><a href="#SignalCli.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="n">callback</span>
</span><span id="SignalCli.__init__-183"><a href="#SignalCli.__init__-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The start up call back.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-184"><a href="#SignalCli.__init__-184"><span class="linenos">184</span></a>        <span class="c1"># set var to hold the main signal process</span>
</span><span id="SignalCli.__init__-185"><a href="#SignalCli.__init__-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Popen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-186"><a href="#SignalCli.__init__-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The main signal-cli process.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-187"><a href="#SignalCli.__init__-187"><span class="linenos">187</span></a>        <span class="c1"># Set sync socket:</span>
</span><span id="SignalCli.__init__-188"><a href="#SignalCli.__init__-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-189"><a href="#SignalCli.__init__-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform sync operations with.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-190"><a href="#SignalCli.__init__-190"><span class="linenos">190</span></a>        <span class="c1"># Set command socket:</span>
</span><span id="SignalCli.__init__-191"><a href="#SignalCli.__init__-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-192"><a href="#SignalCli.__init__-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The socket to preform command operations with.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-193"><a href="#SignalCli.__init__-193"><span class="linenos">193</span></a>        <span class="c1"># Set var to hold the link request:</span>
</span><span id="SignalCli.__init__-194"><a href="#SignalCli.__init__-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-195"><a href="#SignalCli.__init__-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The signal-cli request for linking a new account.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-196"><a href="#SignalCli.__init__-196"><span class="linenos">196</span></a>        <span class="c1"># Set qrencode exec path:</span>
</span><span id="SignalCli.__init__-197"><a href="#SignalCli.__init__-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">__find_qrencode__</span><span class="p">()</span>
</span><span id="SignalCli.__init__-198"><a href="#SignalCli.__init__-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The full path to the qrencode executable.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-199"><a href="#SignalCli.__init__-199"><span class="linenos">199</span></a>        <span class="c1"># Set external properties and objects:</span>
</span><span id="SignalCli.__init__-200"><a href="#SignalCli.__init__-200"><span class="linenos">200</span></a>        <span class="c1"># Set accounts:</span>
</span><span id="SignalCli.__init__-201"><a href="#SignalCli.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Accounts</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-202"><a href="#SignalCli.__init__-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-203"><a href="#SignalCli.__init__-203"><span class="linenos">203</span></a>        <span class="c1"># Set sticker packs:</span>
</span><span id="SignalCli.__init__-204"><a href="#SignalCli.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StickerPacks</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.__init__-205"><a href="#SignalCli.__init__-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-206"><a href="#SignalCli.__init__-206"><span class="linenos">206</span></a>        <span class="c1"># Start signal-cli if requested:</span>
</span><span id="SignalCli.__init__-207"><a href="#SignalCli.__init__-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-208"><a href="#SignalCli.__init__-208"><span class="linenos">208</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-209"><a href="#SignalCli.__init__-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;starting signal-cli&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-210"><a href="#SignalCli.__init__-210"><span class="linenos">210</span></a>            <span class="n">signal_command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__build_signal_command_line__</span><span class="p">()</span>
</span><span id="SignalCli.__init__-211"><a href="#SignalCli.__init__-211"><span class="linenos">211</span></a>            <span class="n">response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">CalledProcessError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_signal__</span><span class="p">(</span><span class="n">signal_command_line</span><span class="p">)</span>
</span><span id="SignalCli.__init__-212"><a href="#SignalCli.__init__-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SignalCli.__init__-213"><a href="#SignalCli.__init__-213"><span class="linenos">213</span></a>                <span class="n">__parse_signal_return_code__</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">signal_command_line</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>  <span class="c1"># NoReturn</span>
</span><span id="SignalCli.__init__-214"><a href="#SignalCli.__init__-214"><span class="linenos">214</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-215"><a href="#SignalCli.__init__-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli started&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-216"><a href="#SignalCli.__init__-216"><span class="linenos">216</span></a>
</span><span id="SignalCli.__init__-217"><a href="#SignalCli.__init__-217"><span class="linenos">217</span></a>        <span class="c1"># Wait for the socket to appear:</span>
</span><span id="SignalCli.__init__-218"><a href="#SignalCli.__init__-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.__init__-219"><a href="#SignalCli.__init__-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="n">start_signal</span><span class="p">:</span>
</span><span id="SignalCli.__init__-220"><a href="#SignalCli.__init__-220"><span class="linenos">220</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;server_address is a socket, and we&#39;re starting signal, wait for socket to appear.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-221"><a href="#SignalCli.__init__-221"><span class="linenos">221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;start waiting for socket&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-222"><a href="#SignalCli.__init__-222"><span class="linenos">222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_signal_socket_file__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>
</span><span id="SignalCli.__init__-223"><a href="#SignalCli.__init__-223"><span class="linenos">223</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;socket found.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-224"><a href="#SignalCli.__init__-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;socket found&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-225"><a href="#SignalCli.__init__-225"><span class="linenos">225</span></a>
</span><span id="SignalCli.__init__-226"><a href="#SignalCli.__init__-226"><span class="linenos">226</span></a>        <span class="c1"># Create sockets and connect to them:</span>
</span><span id="SignalCli.__init__-227"><a href="#SignalCli.__init__-227"><span class="linenos">227</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting to sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-228"><a href="#SignalCli.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connecting to sockets&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-229"><a href="#SignalCli.__init__-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__connect_to_sockets__</span><span class="p">()</span>
</span><span id="SignalCli.__init__-230"><a href="#SignalCli.__init__-230"><span class="linenos">230</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connected to sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-231"><a href="#SignalCli.__init__-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s1">&#39;connected to sockets&#39;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-232"><a href="#SignalCli.__init__-232"><span class="linenos">232</span></a>
</span><span id="SignalCli.__init__-233"><a href="#SignalCli.__init__-233"><span class="linenos">233</span></a>        <span class="c1"># Load stickers:</span>
</span><span id="SignalCli.__init__-234"><a href="#SignalCli.__init__-234"><span class="linenos">234</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading sticker packs.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-235"><a href="#SignalCli.__init__-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span> <span class="o">=</span> <span class="n">StickerPacks</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="SignalCli.__init__-236"><a href="#SignalCli.__init__-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Known StickerPacks object.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-237"><a href="#SignalCli.__init__-237"><span class="linenos">237</span></a>
</span><span id="SignalCli.__init__-238"><a href="#SignalCli.__init__-238"><span class="linenos">238</span></a>        <span class="c1"># Load accounts:</span>
</span><span id="SignalCli.__init__-239"><a href="#SignalCli.__init__-239"><span class="linenos">239</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading accounts.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-240"><a href="#SignalCli.__init__-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">Accounts</span><span class="p">(</span><span class="n">sync_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="SignalCli.__init__-241"><a href="#SignalCli.__init__-241"><span class="linenos">241</span></a>                                 <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span> <span class="n">do_load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SignalCli.__init__-242"><a href="#SignalCli.__init__-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Accounts object.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-243"><a href="#SignalCli.__init__-243"><span class="linenos">243</span></a>
</span><span id="SignalCli.__init__-244"><a href="#SignalCli.__init__-244"><span class="linenos">244</span></a>        <span class="c1"># Create dict to hold processes:</span>
</span><span id="SignalCli.__init__-245"><a href="#SignalCli.__init__-245"><span class="linenos">245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ReceiveThread</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SignalCli.__init__-246"><a href="#SignalCli.__init__-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The dict to store the receive threads.&quot;&quot;&quot;</span>
</span><span id="SignalCli.__init__-247"><a href="#SignalCli.__init__-247"><span class="linenos">247</span></a>
</span><span id="SignalCli.__init__-248"><a href="#SignalCli.__init__-248"><span class="linenos">248</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialization complete.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.__init__-249"><a href="#SignalCli.__init__-249"><span class="linenos">249</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Initialize signal-cli, starting the process if required.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>signal_config_path: Optional[str]</strong>:  The path to the directory signal-cli should use.</li>
<li><strong>signal_exec_path: Optional[str]</strong>:  The path to the signal-cli executable.</li>
<li><strong>server_address: Optional[list[str , int] | tuple[str, int] | str]</strong>:  If signal-cli is already started,
the address of the server, if a unix socket, use a str, otherwise use a tuple/list[hostname:str,port:int]</li>
<li><strong>log_file_path: Optional[str]</strong>:  The path to the signal log file, if None, no logging is preformed.</li>
<li><strong>start_signal: Bool</strong>:  True = start a signal-cli process, False = signal-cli is already running.</li>
<li><strong>callback: Optional[tuple[Callable, Optional[list[Any]]]]</strong>:  The call back as a tuple, the first element
being the callable, and the second element; If not None, is a list of any parameters to provide to the
callback.  The callback signature is: (status: str, *params)</li>
<li><strong>debug: Bool</strong>:  Produce debug output on stdout.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>TypeError</strong>:  If a parameter is of invalid type.</li>
<li><strong>FileNotFoundError</strong>:  If a file / directory doesn't exist when it should.</li>
<li><strong>FileExistsError</strong>:  If a socket file exists when it shouldn't.</li>
<li><strong>RuntimeError</strong>:  If an error occurs while loading signal data, more information in the error message.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.config_path" class="classattr">
                                <div class="attr variable">
            <span class="name">config_path</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#SignalCli.config_path"></a>
    
            <div class="docstring"><p>The full path to the signal config directory.</p>
</div>


                            </div>
                            <div id="SignalCli.accounts" class="classattr">
                                <div class="attr variable">
            <span class="name">accounts</span><span class="annotation">: Optional[<a href="signalAccounts.html#Accounts">SignalCliApi.signalAccounts.Accounts</a>]</span>

        
    </div>
    <a class="headerlink" href="#SignalCli.accounts"></a>
    
            <div class="docstring"><p>The Accounts object.</p>
</div>


                            </div>
                            <div id="SignalCli.sticker_packs" class="classattr">
                                <div class="attr variable">
            <span class="name">sticker_packs</span><span class="annotation">: Optional[<a href="signalSticker.html#StickerPacks">SignalCliApi.signalSticker.StickerPacks</a>]</span>

        
    </div>
    <a class="headerlink" href="#SignalCli.sticker_packs"></a>
    
            <div class="docstring"><p>Known StickerPacks object.</p>
</div>


                            </div>
                            <div id="SignalCli.stop_signal" class="classattr">
                                        <input id="SignalCli.stop_signal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_signal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SignalCli.stop_signal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.stop_signal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.stop_signal-403"><a href="#SignalCli.stop_signal-403"><span class="linenos">403</span></a>    <span class="k">def</span> <span class="nf">stop_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.stop_signal-404"><a href="#SignalCli.stop_signal-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.stop_signal-405"><a href="#SignalCli.stop_signal-405"><span class="linenos">405</span></a><span class="sd">        Stop the signal-cli process.</span>
</span><span id="SignalCli.stop_signal-406"><a href="#SignalCli.stop_signal-406"><span class="linenos">406</span></a><span class="sd">        :returns: None</span>
</span><span id="SignalCli.stop_signal-407"><a href="#SignalCli.stop_signal-407"><span class="linenos">407</span></a><span class="sd">        :raises CommunicationsError: On error closing a socket.</span>
</span><span id="SignalCli.stop_signal-408"><a href="#SignalCli.stop_signal-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.stop_signal-409"><a href="#SignalCli.stop_signal-409"><span class="linenos">409</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_signal</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-410"><a href="#SignalCli.stop_signal-410"><span class="linenos">410</span></a>        <span class="c1"># Close the sockets:</span>
</span><span id="SignalCli.stop_signal-411"><a href="#SignalCli.stop_signal-411"><span class="linenos">411</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Closing sockets.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-412"><a href="#SignalCli.stop_signal-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;closing sockets&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-413"><a href="#SignalCli.stop_signal-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__close_sockets__</span><span class="p">()</span>
</span><span id="SignalCli.stop_signal-414"><a href="#SignalCli.stop_signal-414"><span class="linenos">414</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sockets closed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-415"><a href="#SignalCli.stop_signal-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;sockets closed&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-416"><a href="#SignalCli.stop_signal-416"><span class="linenos">416</span></a>
</span><span id="SignalCli.stop_signal-417"><a href="#SignalCli.stop_signal-417"><span class="linenos">417</span></a>        <span class="c1"># Terminate process:</span>
</span><span id="SignalCli.stop_signal-418"><a href="#SignalCli.stop_signal-418"><span class="linenos">418</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.stop_signal-419"><a href="#SignalCli.stop_signal-419"><span class="linenos">419</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping signal-cli.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-420"><a href="#SignalCli.stop_signal-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;stopping signal-cli&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-421"><a href="#SignalCli.stop_signal-421"><span class="linenos">421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>  <span class="c1"># Kill the process (Sends SigTerm)</span>
</span><span id="SignalCli.stop_signal-422"><a href="#SignalCli.stop_signal-422"><span class="linenos">422</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Flushing pipes.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-423"><a href="#SignalCli.stop_signal-423"><span class="linenos">423</span></a>            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>  <span class="c1"># Flush the pipes.</span>
</span><span id="SignalCli.stop_signal-424"><a href="#SignalCli.stop_signal-424"><span class="linenos">424</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDOUT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stdout</span><span class="p">))</span>
</span><span id="SignalCli.stop_signal-425"><a href="#SignalCli.stop_signal-425"><span class="linenos">425</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STDERR: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
</span><span id="SignalCli.stop_signal-426"><a href="#SignalCli.stop_signal-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Clear the process.</span>
</span><span id="SignalCli.stop_signal-427"><a href="#SignalCli.stop_signal-427"><span class="linenos">427</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-428"><a href="#SignalCli.stop_signal-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__run_callback__</span><span class="p">(</span><span class="s2">&quot;signal-cli stopped&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_signal-429"><a href="#SignalCli.stop_signal-429"><span class="linenos">429</span></a>
</span><span id="SignalCli.stop_signal-430"><a href="#SignalCli.stop_signal-430"><span class="linenos">430</span></a>        <span class="c1"># Remove socket file:</span>
</span><span id="SignalCli.stop_signal-431"><a href="#SignalCli.stop_signal-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.stop_signal-432"><a href="#SignalCli.stop_signal-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__remove_socket_file__</span><span class="p">()</span>
</span><span id="SignalCli.stop_signal-433"><a href="#SignalCli.stop_signal-433"><span class="linenos">433</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Stop the signal-cli process.
:returns: None</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>CommunicationsError</strong>:  On error closing a socket.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.register_account" class="classattr">
                                        <input id="SignalCli.register_account-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_account</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">number</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">captcha</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">voice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n"><a href="signalAccount.html#Account">SignalCliApi.signalAccount.Account</a></span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SignalCli.register_account-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.register_account"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.register_account-435"><a href="#SignalCli.register_account-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">register_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli.register_account-436"><a href="#SignalCli.register_account-436"><span class="linenos">436</span></a>                         <span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SignalCli.register_account-437"><a href="#SignalCli.register_account-437"><span class="linenos">437</span></a>                         <span class="n">captcha</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SignalCli.register_account-438"><a href="#SignalCli.register_account-438"><span class="linenos">438</span></a>                         <span class="n">voice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="SignalCli.register_account-439"><a href="#SignalCli.register_account-439"><span class="linenos">439</span></a>                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SignalCli.register_account-440"><a href="#SignalCli.register_account-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.register_account-441"><a href="#SignalCli.register_account-441"><span class="linenos">441</span></a><span class="sd">                Register a new account. NOTE: Subject to rate limiting.</span>
</span><span id="SignalCli.register_account-442"><a href="#SignalCli.register_account-442"><span class="linenos">442</span></a><span class="sd">                :param number: str: The phone number to register.</span>
</span><span id="SignalCli.register_account-443"><a href="#SignalCli.register_account-443"><span class="linenos">443</span></a><span class="sd">                :param captcha: str: The captcha from &#39;https://signalcaptchas.org/registration/generate.html&#39;, can</span>
</span><span id="SignalCli.register_account-444"><a href="#SignalCli.register_account-444"><span class="linenos">444</span></a><span class="sd">                                        include the &#39;signalcaptcha://&#39;.</span>
</span><span id="SignalCli.register_account-445"><a href="#SignalCli.register_account-445"><span class="linenos">445</span></a><span class="sd">                :param voice: bool: True = Voice call verification, False = SMS verification.</span>
</span><span id="SignalCli.register_account-446"><a href="#SignalCli.register_account-446"><span class="linenos">446</span></a><span class="sd">                :returns: tuple[bool, Account | str]: The first element (bool) is True for success or failure.  The</span>
</span><span id="SignalCli.register_account-447"><a href="#SignalCli.register_account-447"><span class="linenos">447</span></a><span class="sd">                                                        second element on success is the new Account object, which</span>
</span><span id="SignalCli.register_account-448"><a href="#SignalCli.register_account-448"><span class="linenos">448</span></a><span class="sd">                                                        will remain in an unregistered state until verify is called</span>
</span><span id="SignalCli.register_account-449"><a href="#SignalCli.register_account-449"><span class="linenos">449</span></a><span class="sd">                                                        with the verification code.  Upon failure, the second element</span>
</span><span id="SignalCli.register_account-450"><a href="#SignalCli.register_account-450"><span class="linenos">450</span></a><span class="sd">                                                        will contain a string with an error message.</span>
</span><span id="SignalCli.register_account-451"><a href="#SignalCli.register_account-451"><span class="linenos">451</span></a><span class="sd">                :raises: TypeError: If number or captcha are not strings, or if voice is not a boolean.</span>
</span><span id="SignalCli.register_account-452"><a href="#SignalCli.register_account-452"><span class="linenos">452</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="SignalCli.register_account-453"><a href="#SignalCli.register_account-453"><span class="linenos">453</span></a>        <span class="c1"># Log started:</span>
</span><span id="SignalCli.register_account-454"><a href="#SignalCli.register_account-454"><span class="linenos">454</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_account</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.register_account-455"><a href="#SignalCli.register_account-455"><span class="linenos">455</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Register started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-456"><a href="#SignalCli.register_account-456"><span class="linenos">456</span></a>
</span><span id="SignalCli.register_account-457"><a href="#SignalCli.register_account-457"><span class="linenos">457</span></a>        <span class="c1"># Type check arguments:</span>
</span><span id="SignalCli.register_account-458"><a href="#SignalCli.register_account-458"><span class="linenos">458</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-459"><a href="#SignalCli.register_account-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.register_account-460"><a href="#SignalCli.register_account-460"><span class="linenos">460</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: number is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="SignalCli.register_account-461"><a href="#SignalCli.register_account-461"><span class="linenos">461</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
</span><span id="SignalCli.register_account-462"><a href="#SignalCli.register_account-462"><span class="linenos">462</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli.register_account-463"><a href="#SignalCli.register_account-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">captcha</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.register_account-464"><a href="#SignalCli.register_account-464"><span class="linenos">464</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: captcha is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;str&#39;.&quot;</span>
</span><span id="SignalCli.register_account-465"><a href="#SignalCli.register_account-465"><span class="linenos">465</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">captcha</span><span class="p">)))</span>
</span><span id="SignalCli.register_account-466"><a href="#SignalCli.register_account-466"><span class="linenos">466</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;captcha&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="n">captcha</span><span class="p">)</span>
</span><span id="SignalCli.register_account-467"><a href="#SignalCli.register_account-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli.register_account-468"><a href="#SignalCli.register_account-468"><span class="linenos">468</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;TypeError: voice is type &#39;</span><span class="si">%s</span><span class="s2">&#39;, expected &#39;bool&#39;.&quot;</span>
</span><span id="SignalCli.register_account-469"><a href="#SignalCli.register_account-469"><span class="linenos">469</span></a>                            <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">voice</span><span class="p">)))</span>
</span><span id="SignalCli.register_account-470"><a href="#SignalCli.register_account-470"><span class="linenos">470</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;voice&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">voice</span><span class="p">)</span>
</span><span id="SignalCli.register_account-471"><a href="#SignalCli.register_account-471"><span class="linenos">471</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Type checks passed.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-472"><a href="#SignalCli.register_account-472"><span class="linenos">472</span></a>        <span class="c1"># Value Check arguments:</span>
</span><span id="SignalCli.register_account-473"><a href="#SignalCli.register_account-473"><span class="linenos">473</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Value checks.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-474"><a href="#SignalCli.register_account-474"><span class="linenos">474</span></a>        <span class="n">number_match</span> <span class="o">=</span> <span class="n">phone_number_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli.register_account-475"><a href="#SignalCli.register_account-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">number_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.register_account-476"><a href="#SignalCli.register_account-476"><span class="linenos">476</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;number must be in format +nnnnnnnn....&quot;</span>
</span><span id="SignalCli.register_account-477"><a href="#SignalCli.register_account-477"><span class="linenos">477</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-478"><a href="#SignalCli.register_account-478"><span class="linenos">478</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli.register_account-479"><a href="#SignalCli.register_account-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signalcaptcha://&#39;</span><span class="p">):</span>
</span><span id="SignalCli.register_account-480"><a href="#SignalCli.register_account-480"><span class="linenos">480</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stripping signalcaptcha:// from captcha.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-481"><a href="#SignalCli.register_account-481"><span class="linenos">481</span></a>            <span class="n">captcha</span> <span class="o">=</span> <span class="n">captcha</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span><span id="SignalCli.register_account-482"><a href="#SignalCli.register_account-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-recaptcha-&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">captcha</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;signal-hcaptcha&#39;</span><span class="p">):</span>
</span><span id="SignalCli.register_account-483"><a href="#SignalCli.register_account-483"><span class="linenos">483</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Invalid captcha.&quot;</span>
</span><span id="SignalCli.register_account-484"><a href="#SignalCli.register_account-484"><span class="linenos">484</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, ValueError: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-485"><a href="#SignalCli.register_account-485"><span class="linenos">485</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli.register_account-486"><a href="#SignalCli.register_account-486"><span class="linenos">486</span></a>        <span class="c1"># Check if the account exists, and isn&#39;t registered.</span>
</span><span id="SignalCli.register_account-487"><a href="#SignalCli.register_account-487"><span class="linenos">487</span></a>        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">get_by_number</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span id="SignalCli.register_account-488"><a href="#SignalCli.register_account-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.register_account-489"><a href="#SignalCli.register_account-489"><span class="linenos">489</span></a>            <span class="k">if</span> <span class="n">account</span><span class="o">.</span><span class="n">registered</span><span class="p">:</span>
</span><span id="SignalCli.register_account-490"><a href="#SignalCli.register_account-490"><span class="linenos">490</span></a>                <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Account already registered.&quot;</span>
</span><span id="SignalCli.register_account-491"><a href="#SignalCli.register_account-491"><span class="linenos">491</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Returning False, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-492"><a href="#SignalCli.register_account-492"><span class="linenos">492</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">error_message</span>
</span><span id="SignalCli.register_account-493"><a href="#SignalCli.register_account-493"><span class="linenos">493</span></a>        <span class="c1"># Create register account command object and json command string:</span>
</span><span id="SignalCli.register_account-494"><a href="#SignalCli.register_account-494"><span class="linenos">494</span></a>        <span class="n">register_account_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli.register_account-495"><a href="#SignalCli.register_account-495"><span class="linenos">495</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli.register_account-496"><a href="#SignalCli.register_account-496"><span class="linenos">496</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli.register_account-497"><a href="#SignalCli.register_account-497"><span class="linenos">497</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span>
</span><span id="SignalCli.register_account-498"><a href="#SignalCli.register_account-498"><span class="linenos">498</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli.register_account-499"><a href="#SignalCli.register_account-499"><span class="linenos">499</span></a>                <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
</span><span id="SignalCli.register_account-500"><a href="#SignalCli.register_account-500"><span class="linenos">500</span></a>                <span class="s2">&quot;captcha&quot;</span><span class="p">:</span> <span class="n">captcha</span><span class="p">,</span>
</span><span id="SignalCli.register_account-501"><a href="#SignalCli.register_account-501"><span class="linenos">501</span></a>                <span class="s2">&quot;voice&quot;</span><span class="p">:</span> <span class="n">voice</span><span class="p">,</span>
</span><span id="SignalCli.register_account-502"><a href="#SignalCli.register_account-502"><span class="linenos">502</span></a>            <span class="p">}</span>
</span><span id="SignalCli.register_account-503"><a href="#SignalCli.register_account-503"><span class="linenos">503</span></a>        <span class="p">}</span>
</span><span id="SignalCli.register_account-504"><a href="#SignalCli.register_account-504"><span class="linenos">504</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">register_account_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli.register_account-505"><a href="#SignalCli.register_account-505"><span class="linenos">505</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli.register_account-506"><a href="#SignalCli.register_account-506"><span class="linenos">506</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli.register_account-507"><a href="#SignalCli.register_account-507"><span class="linenos">507</span></a>        <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>
</span><span id="SignalCli.register_account-508"><a href="#SignalCli.register_account-508"><span class="linenos">508</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli.register_account-509"><a href="#SignalCli.register_account-509"><span class="linenos">509</span></a>        <span class="c1"># TODO: Fix error checking:</span>
</span><span id="SignalCli.register_account-510"><a href="#SignalCli.register_account-510"><span class="linenos">510</span></a>        <span class="c1"># Check for error:</span>
</span><span id="SignalCli.register_account-511"><a href="#SignalCli.register_account-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">response_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SignalCli.register_account-512"><a href="#SignalCli.register_account-512"><span class="linenos">512</span></a>            <span class="c1"># Delete local account data, since signal-cli creates data for the account.</span>
</span><span id="SignalCli.register_account-513"><a href="#SignalCli.register_account-513"><span class="linenos">513</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting incomplete account.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-514"><a href="#SignalCli.register_account-514"><span class="linenos">514</span></a>            <span class="n">delete_local_data_command_obj</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli.register_account-515"><a href="#SignalCli.register_account-515"><span class="linenos">515</span></a>                <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli.register_account-516"><a href="#SignalCli.register_account-516"><span class="linenos">516</span></a>                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="SignalCli.register_account-517"><a href="#SignalCli.register_account-517"><span class="linenos">517</span></a>                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;deleteLocalAccountData&quot;</span><span class="p">,</span>
</span><span id="SignalCli.register_account-518"><a href="#SignalCli.register_account-518"><span class="linenos">518</span></a>                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli.register_account-519"><a href="#SignalCli.register_account-519"><span class="linenos">519</span></a>                    <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="n">number</span>
</span><span id="SignalCli.register_account-520"><a href="#SignalCli.register_account-520"><span class="linenos">520</span></a>                <span class="p">}</span>
</span><span id="SignalCli.register_account-521"><a href="#SignalCli.register_account-521"><span class="linenos">521</span></a>            <span class="p">}</span>
</span><span id="SignalCli.register_account-522"><a href="#SignalCli.register_account-522"><span class="linenos">522</span></a>            <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">delete_local_data_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli.register_account-523"><a href="#SignalCli.register_account-523"><span class="linenos">523</span></a>            <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli.register_account-524"><a href="#SignalCli.register_account-524"><span class="linenos">524</span></a>            <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli.register_account-525"><a href="#SignalCli.register_account-525"><span class="linenos">525</span></a>            <span class="n">response_str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sync_socket</span><span class="p">)</span>  <span class="c1"># output unused, we don&#39;t care if it failed.</span>
</span><span id="SignalCli.register_account-526"><a href="#SignalCli.register_account-526"><span class="linenos">526</span></a>            <span class="c1"># TODO: Error check delete request response and at least warn about it.</span>
</span><span id="SignalCli.register_account-527"><a href="#SignalCli.register_account-527"><span class="linenos">527</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Delete account response: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli.register_account-528"><a href="#SignalCli.register_account-528"><span class="linenos">528</span></a>            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Signal error, code: </span><span class="si">%i</span><span class="s2">, message: </span><span class="si">%s</span><span class="s2">&quot;</span> \
</span><span id="SignalCli.register_account-529"><a href="#SignalCli.register_account-529"><span class="linenos">529</span></a>                            <span class="o">%</span> <span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
</span><span id="SignalCli.register_account-530"><a href="#SignalCli.register_account-530"><span class="linenos">530</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Raising SignalError(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-531"><a href="#SignalCli.register_account-531"><span class="linenos">531</span></a>            <span class="k">raise</span> <span class="n">SignalError</span><span class="p">(</span><span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;code&#39;</span><span class="p">],</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-532"><a href="#SignalCli.register_account-532"><span class="linenos">532</span></a>
</span><span id="SignalCli.register_account-533"><a href="#SignalCli.register_account-533"><span class="linenos">533</span></a>        <span class="c1"># No error found, get the new account:</span>
</span><span id="SignalCli.register_account-534"><a href="#SignalCli.register_account-534"><span class="linenos">534</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Registration successful, syncing accounts with disk...&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-535"><a href="#SignalCli.register_account-535"><span class="linenos">535</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="SignalCli.register_account-536"><a href="#SignalCli.register_account-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SignalCli.register_account-537"><a href="#SignalCli.register_account-537"><span class="linenos">537</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="SignalCli.register_account-538"><a href="#SignalCli.register_account-538"><span class="linenos">538</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-539"><a href="#SignalCli.register_account-539"><span class="linenos">539</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.register_account-540"><a href="#SignalCli.register_account-540"><span class="linenos">540</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Account registered. Don&#39;t forget to verify.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.register_account-541"><a href="#SignalCli.register_account-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Register a new account. NOTE: Subject to rate limiting.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>number: str</strong>:  The phone number to register.</li>
<li><strong>captcha: str: The captcha from 'https</strong>: //signalcaptchas.org/registration/generate.html', can
include the 'signalcaptcha://'.</li>
<li><strong>voice: bool</strong>:  True = Voice call verification, False = SMS verification.
:returns: tuple[bool, Account | str]: The first element (bool) is True for success or failure.  The
second element on success is the new Account object, which
will remain in an unregistered state until verify is called
with the verification code.  Upon failure, the second element
will contain a string with an error message.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li>TypeError: If number or captcha are not strings, or if voice is not a boolean.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.start_link" class="classattr">
                                        <input id="SignalCli.start_link-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_link</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">gen_text_qr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">png_qr_code_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="SignalCli.start_link-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.start_link"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.start_link-543"><a href="#SignalCli.start_link-543"><span class="linenos">543</span></a>    <span class="k">def</span> <span class="nf">start_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli.start_link-544"><a href="#SignalCli.start_link-544"><span class="linenos">544</span></a>                   <span class="n">gen_text_qr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SignalCli.start_link-545"><a href="#SignalCli.start_link-545"><span class="linenos">545</span></a>                   <span class="n">png_qr_code_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_link-546"><a href="#SignalCli.start_link-546"><span class="linenos">546</span></a>                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="SignalCli.start_link-547"><a href="#SignalCli.start_link-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.start_link-548"><a href="#SignalCli.start_link-548"><span class="linenos">548</span></a><span class="sd">        Start the link process for linking an existing account.</span>
</span><span id="SignalCli.start_link-549"><a href="#SignalCli.start_link-549"><span class="linenos">549</span></a><span class="sd">        :param gen_text_qr: bool: True, generate text qr-code, False, do not.</span>
</span><span id="SignalCli.start_link-550"><a href="#SignalCli.start_link-550"><span class="linenos">550</span></a><span class="sd">        :param png_qr_code_file_path: Optional[str]: The file path to generate the png qr code at, if None, the qr code</span>
</span><span id="SignalCli.start_link-551"><a href="#SignalCli.start_link-551"><span class="linenos">551</span></a><span class="sd">            is not generated.</span>
</span><span id="SignalCli.start_link-552"><a href="#SignalCli.start_link-552"><span class="linenos">552</span></a><span class="sd">        :returns: tuple[str, str, str]: The first element is the link url generated by signal.</span>
</span><span id="SignalCli.start_link-553"><a href="#SignalCli.start_link-553"><span class="linenos">553</span></a><span class="sd">            The second element is a text QR code string, or an empty string if qrencode is not installed.</span>
</span><span id="SignalCli.start_link-554"><a href="#SignalCli.start_link-554"><span class="linenos">554</span></a><span class="sd">            The third element is a path to a generated png qrencode, or an empty string if qrencode is not installed.</span>
</span><span id="SignalCli.start_link-555"><a href="#SignalCli.start_link-555"><span class="linenos">555</span></a><span class="sd">        :raises: TypeError: If name is not a string or None.</span>
</span><span id="SignalCli.start_link-556"><a href="#SignalCli.start_link-556"><span class="linenos">556</span></a><span class="sd">        :raises: LinkInProgress: If a link is already in progress when start_link_account is called a second time and</span>
</span><span id="SignalCli.start_link-557"><a href="#SignalCli.start_link-557"><span class="linenos">557</span></a><span class="sd">            finish_link has not been called.</span>
</span><span id="SignalCli.start_link-558"><a href="#SignalCli.start_link-558"><span class="linenos">558</span></a><span class="sd">        :raises InvalidServerResponse: If the signal link doesn&#39;t seem valid.</span>
</span><span id="SignalCli.start_link-559"><a href="#SignalCli.start_link-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.start_link-560"><a href="#SignalCli.start_link-560"><span class="linenos">560</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_link</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.start_link-561"><a href="#SignalCli.start_link-561"><span class="linenos">561</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Staring link process...&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-562"><a href="#SignalCli.start_link-562"><span class="linenos">562</span></a>
</span><span id="SignalCli.start_link-563"><a href="#SignalCli.start_link-563"><span class="linenos">563</span></a>        <span class="c1"># Type checks:</span>
</span><span id="SignalCli.start_link-564"><a href="#SignalCli.start_link-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gen_text_qr</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="SignalCli.start_link-565"><a href="#SignalCli.start_link-565"><span class="linenos">565</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-566"><a href="#SignalCli.start_link-566"><span class="linenos">566</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">))</span>
</span><span id="SignalCli.start_link-567"><a href="#SignalCli.start_link-567"><span class="linenos">567</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;gen_text_qr&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="n">gen_text_qr</span><span class="p">)</span>
</span><span id="SignalCli.start_link-568"><a href="#SignalCli.start_link-568"><span class="linenos">568</span></a>
</span><span id="SignalCli.start_link-569"><a href="#SignalCli.start_link-569"><span class="linenos">569</span></a>        <span class="k">if</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.start_link-570"><a href="#SignalCli.start_link-570"><span class="linenos">570</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-571"><a href="#SignalCli.start_link-571"><span class="linenos">571</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;png_qr_code_file_path&quot;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">))</span>
</span><span id="SignalCli.start_link-572"><a href="#SignalCli.start_link-572"><span class="linenos">572</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;png_qr_code_file_path&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">)</span>
</span><span id="SignalCli.start_link-573"><a href="#SignalCli.start_link-573"><span class="linenos">573</span></a>
</span><span id="SignalCli.start_link-574"><a href="#SignalCli.start_link-574"><span class="linenos">574</span></a>        <span class="c1"># Check for a running link request:</span>
</span><span id="SignalCli.start_link-575"><a href="#SignalCli.start_link-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.start_link-576"><a href="#SignalCli.start_link-576"><span class="linenos">576</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkInProgressError().&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-577"><a href="#SignalCli.start_link-577"><span class="linenos">577</span></a>            <span class="k">raise</span> <span class="n">LinkInProgress</span><span class="p">()</span>
</span><span id="SignalCli.start_link-578"><a href="#SignalCli.start_link-578"><span class="linenos">578</span></a>
</span><span id="SignalCli.start_link-579"><a href="#SignalCli.start_link-579"><span class="linenos">579</span></a>        <span class="c1"># Ensure sigal is running:</span>
</span><span id="SignalCli.start_link-580"><a href="#SignalCli.start_link-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.start_link-581"><a href="#SignalCli.start_link-581"><span class="linenos">581</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-clil not running&quot;</span>
</span><span id="SignalCli.start_link-582"><a href="#SignalCli.start_link-582"><span class="linenos">582</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.start_link-583"><a href="#SignalCli.start_link-583"><span class="linenos">583</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.start_link-584"><a href="#SignalCli.start_link-584"><span class="linenos">584</span></a>
</span><span id="SignalCli.start_link-585"><a href="#SignalCli.start_link-585"><span class="linenos">585</span></a>        <span class="c1"># Create link request object:</span>
</span><span id="SignalCli.start_link-586"><a href="#SignalCli.start_link-586"><span class="linenos">586</span></a>        <span class="n">link_request_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli.start_link-587"><a href="#SignalCli.start_link-587"><span class="linenos">587</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli.start_link-588"><a href="#SignalCli.start_link-588"><span class="linenos">588</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli.start_link-589"><a href="#SignalCli.start_link-589"><span class="linenos">589</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;startLink&quot;</span><span class="p">,</span>
</span><span id="SignalCli.start_link-590"><a href="#SignalCli.start_link-590"><span class="linenos">590</span></a>        <span class="p">}</span>
</span><span id="SignalCli.start_link-591"><a href="#SignalCli.start_link-591"><span class="linenos">591</span></a>
</span><span id="SignalCli.start_link-592"><a href="#SignalCli.start_link-592"><span class="linenos">592</span></a>        <span class="c1"># Create json command string:</span>
</span><span id="SignalCli.start_link-593"><a href="#SignalCli.start_link-593"><span class="linenos">593</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_request_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli.start_link-594"><a href="#SignalCli.start_link-594"><span class="linenos">594</span></a>
</span><span id="SignalCli.start_link-595"><a href="#SignalCli.start_link-595"><span class="linenos">595</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli.start_link-596"><a href="#SignalCli.start_link-596"><span class="linenos">596</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli.start_link-597"><a href="#SignalCli.start_link-597"><span class="linenos">597</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="SignalCli.start_link-598"><a href="#SignalCli.start_link-598"><span class="linenos">598</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>
</span><span id="SignalCli.start_link-599"><a href="#SignalCli.start_link-599"><span class="linenos">599</span></a>        <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">)</span>
</span><span id="SignalCli.start_link-600"><a href="#SignalCli.start_link-600"><span class="linenos">600</span></a>
</span><span id="SignalCli.start_link-601"><a href="#SignalCli.start_link-601"><span class="linenos">601</span></a>        <span class="c1"># Gather the link from response obj:</span>
</span><span id="SignalCli.start_link-602"><a href="#SignalCli.start_link-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;deviceLinkUri&#39;</span><span class="p">]</span>
</span><span id="SignalCli.start_link-603"><a href="#SignalCli.start_link-603"><span class="linenos">603</span></a>
</span><span id="SignalCli.start_link-604"><a href="#SignalCli.start_link-604"><span class="linenos">604</span></a>        <span class="c1"># Generate text qrcode:</span>
</span><span id="SignalCli.start_link-605"><a href="#SignalCli.start_link-605"><span class="linenos">605</span></a>        <span class="n">text_qr_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.start_link-606"><a href="#SignalCli.start_link-606"><span class="linenos">606</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gen_text_qr</span><span class="p">:</span>
</span><span id="SignalCli.start_link-607"><a href="#SignalCli.start_link-607"><span class="linenos">607</span></a>            <span class="n">command_line</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--type=UTF8&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">]</span>
</span><span id="SignalCli.start_link-608"><a href="#SignalCli.start_link-608"><span class="linenos">608</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate UTF8 QR-Code...&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-609"><a href="#SignalCli.start_link-609"><span class="linenos">609</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli.start_link-610"><a href="#SignalCli.start_link-610"><span class="linenos">610</span></a>                <span class="n">bytes_text_qr_code</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">command_line</span><span class="p">)</span>
</span><span id="SignalCli.start_link-611"><a href="#SignalCli.start_link-611"><span class="linenos">611</span></a>                <span class="n">text_qr_code</span> <span class="o">=</span> <span class="n">bytes_text_qr_code</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF8&#39;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-612"><a href="#SignalCli.start_link-612"><span class="linenos">612</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;UTF8 QR-Code successfully created.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-613"><a href="#SignalCli.start_link-613"><span class="linenos">613</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="SignalCli.start_link-614"><a href="#SignalCli.start_link-614"><span class="linenos">614</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate UTF8 QR-Code.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-615"><a href="#SignalCli.start_link-615"><span class="linenos">615</span></a>
</span><span id="SignalCli.start_link-616"><a href="#SignalCli.start_link-616"><span class="linenos">616</span></a>        <span class="c1"># Generate png qrcode:</span>
</span><span id="SignalCli.start_link-617"><a href="#SignalCli.start_link-617"><span class="linenos">617</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">png_qr_code_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.start_link-618"><a href="#SignalCli.start_link-618"><span class="linenos">618</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attempting to generate png QR-Code...&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-619"><a href="#SignalCli.start_link-619"><span class="linenos">619</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli.start_link-620"><a href="#SignalCli.start_link-620"><span class="linenos">620</span></a>                <span class="n">check_call</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_qrencode_exec_path</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">])</span>
</span><span id="SignalCli.start_link-621"><a href="#SignalCli.start_link-621"><span class="linenos">621</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;png QR-Code successfully generated.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-622"><a href="#SignalCli.start_link-622"><span class="linenos">622</span></a>            <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="SignalCli.start_link-623"><a href="#SignalCli.start_link-623"><span class="linenos">623</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate png QR-Code.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-624"><a href="#SignalCli.start_link-624"><span class="linenos">624</span></a>
</span><span id="SignalCli.start_link-625"><a href="#SignalCli.start_link-625"><span class="linenos">625</span></a>        <span class="c1"># Linking started successfully:</span>
</span><span id="SignalCli.start_link-626"><a href="#SignalCli.start_link-626"><span class="linenos">626</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Link process successfully started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_link-627"><a href="#SignalCli.start_link-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span> <span class="n">text_qr_code</span><span class="p">,</span> <span class="n">png_qr_code_file_path</span>
</span></pre></div>


            <div class="docstring"><p>Start the link process for linking an existing account.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>gen_text_qr: bool</strong>:  True, generate text qr-code, False, do not.</li>
<li><strong>png_qr_code_file_path: Optional[str]</strong>:  The file path to generate the png qr code at, if None, the qr code
is not generated.
:returns: tuple[str, str, str]: The first element is the link url generated by signal.
The second element is a text QR code string, or an empty string if qrencode is not installed.
The third element is a path to a generated png qrencode, or an empty string if qrencode is not installed.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li>TypeError: If name is not a string or None.</li>
<li>LinkInProgress: If a link is already in progress when start_link_account is called a second time and
finish_link has not been called.</li>
<li><strong>InvalidServerResponse</strong>:  If the signal link doesn't seem valid.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.finish_link" class="classattr">
                                        <input id="SignalCli.finish_link-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">finish_link</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">device_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n"><a href="signalAccount.html#Account">SignalCliApi.signalAccount.Account</a></span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SignalCli.finish_link-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.finish_link"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.finish_link-629"><a href="#SignalCli.finish_link-629"><span class="linenos">629</span></a>    <span class="k">def</span> <span class="nf">finish_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Account</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="SignalCli.finish_link-630"><a href="#SignalCli.finish_link-630"><span class="linenos">630</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.finish_link-631"><a href="#SignalCli.finish_link-631"><span class="linenos">631</span></a><span class="sd">        Finish the linking process after confirming the link on the primary device.</span>
</span><span id="SignalCli.finish_link-632"><a href="#SignalCli.finish_link-632"><span class="linenos">632</span></a><span class="sd">        :param device_name: Optional[str]: The device name to give this link.</span>
</span><span id="SignalCli.finish_link-633"><a href="#SignalCli.finish_link-633"><span class="linenos">633</span></a><span class="sd">        :returns: tuple[bool, Account | str]: The first element is a bool representing success or failure; The second</span>
</span><span id="SignalCli.finish_link-634"><a href="#SignalCli.finish_link-634"><span class="linenos">634</span></a><span class="sd">                                                element on success will be the new Account object, or on failure will be</span>
</span><span id="SignalCli.finish_link-635"><a href="#SignalCli.finish_link-635"><span class="linenos">635</span></a><span class="sd">                                                a string containing an error message.</span>
</span><span id="SignalCli.finish_link-636"><a href="#SignalCli.finish_link-636"><span class="linenos">636</span></a><span class="sd">        :raises LinkNotStarted: If the link process hasn&#39;t been started yet.</span>
</span><span id="SignalCli.finish_link-637"><a href="#SignalCli.finish_link-637"><span class="linenos">637</span></a><span class="sd">        :raises InvalidServerResponse: If the signal success code is not recognized.</span>
</span><span id="SignalCli.finish_link-638"><a href="#SignalCli.finish_link-638"><span class="linenos">638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.finish_link-639"><a href="#SignalCli.finish_link-639"><span class="linenos">639</span></a>        <span class="n">logger_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_link</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="SignalCli.finish_link-640"><a href="#SignalCli.finish_link-640"><span class="linenos">640</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-641"><a href="#SignalCli.finish_link-641"><span class="linenos">641</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finish link process started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-642"><a href="#SignalCli.finish_link-642"><span class="linenos">642</span></a>
</span><span id="SignalCli.finish_link-643"><a href="#SignalCli.finish_link-643"><span class="linenos">643</span></a>        <span class="c1"># Type check name:</span>
</span><span id="SignalCli.finish_link-644"><a href="#SignalCli.finish_link-644"><span class="linenos">644</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SignalCli.finish_link-645"><a href="#SignalCli.finish_link-645"><span class="linenos">645</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-646"><a href="#SignalCli.finish_link-646"><span class="linenos">646</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;device_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[str]&#39;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">))</span>
</span><span id="SignalCli.finish_link-647"><a href="#SignalCli.finish_link-647"><span class="linenos">647</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;device_name&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[str]&quot;</span><span class="p">,</span> <span class="n">device_name</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-648"><a href="#SignalCli.finish_link-648"><span class="linenos">648</span></a>
</span><span id="SignalCli.finish_link-649"><a href="#SignalCli.finish_link-649"><span class="linenos">649</span></a>        <span class="c1"># Check for a link process:</span>
</span><span id="SignalCli.finish_link-650"><a href="#SignalCli.finish_link-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-651"><a href="#SignalCli.finish_link-651"><span class="linenos">651</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising LinkNotStarted().&quot;</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-652"><a href="#SignalCli.finish_link-652"><span class="linenos">652</span></a>            <span class="k">raise</span> <span class="n">LinkNotStarted</span><span class="p">()</span>
</span><span id="SignalCli.finish_link-653"><a href="#SignalCli.finish_link-653"><span class="linenos">653</span></a>
</span><span id="SignalCli.finish_link-654"><a href="#SignalCli.finish_link-654"><span class="linenos">654</span></a>        <span class="c1"># Check for running signal-cli:</span>
</span><span id="SignalCli.finish_link-655"><a href="#SignalCli.finish_link-655"><span class="linenos">655</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signal_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-656"><a href="#SignalCli.finish_link-656"><span class="linenos">656</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;signal-cli not running&quot;</span>
</span><span id="SignalCli.finish_link-657"><a href="#SignalCli.finish_link-657"><span class="linenos">657</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-658"><a href="#SignalCli.finish_link-658"><span class="linenos">658</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-659"><a href="#SignalCli.finish_link-659"><span class="linenos">659</span></a>
</span><span id="SignalCli.finish_link-660"><a href="#SignalCli.finish_link-660"><span class="linenos">660</span></a>        <span class="c1"># Generate the finishLink command object:</span>
</span><span id="SignalCli.finish_link-661"><a href="#SignalCli.finish_link-661"><span class="linenos">661</span></a>        <span class="n">link_finish_command_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SignalCli.finish_link-662"><a href="#SignalCli.finish_link-662"><span class="linenos">662</span></a>            <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="SignalCli.finish_link-663"><a href="#SignalCli.finish_link-663"><span class="linenos">663</span></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SignalCli.finish_link-664"><a href="#SignalCli.finish_link-664"><span class="linenos">664</span></a>            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;finishLink&quot;</span><span class="p">,</span>
</span><span id="SignalCli.finish_link-665"><a href="#SignalCli.finish_link-665"><span class="linenos">665</span></a>            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="SignalCli.finish_link-666"><a href="#SignalCli.finish_link-666"><span class="linenos">666</span></a>                <span class="s2">&quot;deviceLinkUri&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span><span class="p">,</span>
</span><span id="SignalCli.finish_link-667"><a href="#SignalCli.finish_link-667"><span class="linenos">667</span></a>            <span class="p">}</span>
</span><span id="SignalCli.finish_link-668"><a href="#SignalCli.finish_link-668"><span class="linenos">668</span></a>        <span class="p">}</span>
</span><span id="SignalCli.finish_link-669"><a href="#SignalCli.finish_link-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-670"><a href="#SignalCli.finish_link-670"><span class="linenos">670</span></a>            <span class="n">link_finish_command_obj</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;deviceName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
</span><span id="SignalCli.finish_link-671"><a href="#SignalCli.finish_link-671"><span class="linenos">671</span></a>
</span><span id="SignalCli.finish_link-672"><a href="#SignalCli.finish_link-672"><span class="linenos">672</span></a>        <span class="c1"># Generate json command string:</span>
</span><span id="SignalCli.finish_link-673"><a href="#SignalCli.finish_link-673"><span class="linenos">673</span></a>        <span class="n">json_command_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">link_finish_command_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="SignalCli.finish_link-674"><a href="#SignalCli.finish_link-674"><span class="linenos">674</span></a>
</span><span id="SignalCli.finish_link-675"><a href="#SignalCli.finish_link-675"><span class="linenos">675</span></a>        <span class="c1"># Communicate with signal:</span>
</span><span id="SignalCli.finish_link-676"><a href="#SignalCli.finish_link-676"><span class="linenos">676</span></a>        <span class="n">__socket_send__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span> <span class="n">json_command_str</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-677"><a href="#SignalCli.finish_link-677"><span class="linenos">677</span></a>        <span class="n">response_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">__socket_receive__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-678"><a href="#SignalCli.finish_link-678"><span class="linenos">678</span></a>        <span class="n">response_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">__parse_signal_response__</span><span class="p">(</span><span class="n">response_str</span><span class="p">)</span>  <span class="c1"># Raises Invalid server response</span>
</span><span id="SignalCli.finish_link-679"><a href="#SignalCli.finish_link-679"><span class="linenos">679</span></a>
</span><span id="SignalCli.finish_link-680"><a href="#SignalCli.finish_link-680"><span class="linenos">680</span></a>        <span class="c1"># Check for error:</span>
</span><span id="SignalCli.finish_link-681"><a href="#SignalCli.finish_link-681"><span class="linenos">681</span></a>        <span class="n">error_occurred</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span> <span class="o">=</span> <span class="n">__check_response_for_error__</span><span class="p">(</span><span class="n">response_obj</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</span><span id="SignalCli.finish_link-682"><a href="#SignalCli.finish_link-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="n">error_occurred</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-683"><a href="#SignalCli.finish_link-683"><span class="linenos">683</span></a>            <span class="k">if</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># User already exists:</span>
</span><span id="SignalCli.finish_link-684"><a href="#SignalCli.finish_link-684"><span class="linenos">684</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;user already exists&quot;</span>
</span><span id="SignalCli.finish_link-685"><a href="#SignalCli.finish_link-685"><span class="linenos">685</span></a>            <span class="k">elif</span> <span class="n">error_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>  <span class="c1"># Timeout</span>
</span><span id="SignalCli.finish_link-686"><a href="#SignalCli.finish_link-686"><span class="linenos">686</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span>
</span><span id="SignalCli.finish_link-687"><a href="#SignalCli.finish_link-687"><span class="linenos">687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-688"><a href="#SignalCli.finish_link-688"><span class="linenos">688</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Unhandled non-fatal error. Code </span><span class="si">%i</span><span class="s2">, Message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-689"><a href="#SignalCli.finish_link-689"><span class="linenos">689</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-690"><a href="#SignalCli.finish_link-690"><span class="linenos">690</span></a>
</span><span id="SignalCli.finish_link-691"><a href="#SignalCli.finish_link-691"><span class="linenos">691</span></a>        <span class="c1"># Gather linked number from response:</span>
</span><span id="SignalCli.finish_link-692"><a href="#SignalCli.finish_link-692"><span class="linenos">692</span></a>        <span class="n">linked_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">response_obj</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
</span><span id="SignalCli.finish_link-693"><a href="#SignalCli.finish_link-693"><span class="linenos">693</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Link successful for account: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">linked_number</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-694"><a href="#SignalCli.finish_link-694"><span class="linenos">694</span></a>
</span><span id="SignalCli.finish_link-695"><a href="#SignalCli.finish_link-695"><span class="linenos">695</span></a>        <span class="c1"># Sync accounts and get the new account:</span>
</span><span id="SignalCli.finish_link-696"><a href="#SignalCli.finish_link-696"><span class="linenos">696</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Syncing accounts with disk.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-697"><a href="#SignalCli.finish_link-697"><span class="linenos">697</span></a>        <span class="n">new_accounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">__sync__</span><span class="p">()</span>
</span><span id="SignalCli.finish_link-698"><a href="#SignalCli.finish_link-698"><span class="linenos">698</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_accounts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SignalCli.finish_link-699"><a href="#SignalCli.finish_link-699"><span class="linenos">699</span></a>            <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Failed to locate new account.&quot;</span>
</span><span id="SignalCli.finish_link-700"><a href="#SignalCli.finish_link-700"><span class="linenos">700</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising RuntimeError(</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-701"><a href="#SignalCli.finish_link-701"><span class="linenos">701</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</span><span id="SignalCli.finish_link-702"><a href="#SignalCli.finish_link-702"><span class="linenos">702</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_link_request</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.finish_link-703"><a href="#SignalCli.finish_link-703"><span class="linenos">703</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">new_accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Finish the linking process after confirming the link on the primary device.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>device_name: Optional[str]</strong>:  The device name to give this link.
:returns: tuple[bool, Account | str]: The first element is a bool representing success or failure; The second
element on success will be the new Account object, or on failure will be
a string containing an error message.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>LinkNotStarted</strong>:  If the link process hasn't been started yet.</li>
<li><strong>InvalidServerResponse</strong>:  If the signal success code is not recognized.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.start_receive" class="classattr">
                                        <input id="SignalCli.start_receive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_receive</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">account</span><span class="p">:</span> <span class="n"><a href="signalAccount.html#Account">SignalCliApi.signalAccount.Account</a></span>,</span><span class="param">	<span class="n">all_messages_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">received_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">receipt_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sync_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">typing_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">story_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">payment_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">reaction_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">call_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SignalCli.start_receive-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.start_receive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.start_receive-705"><a href="#SignalCli.start_receive-705"><span class="linenos">705</span></a>    <span class="k">def</span> <span class="nf">start_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-706"><a href="#SignalCli.start_receive-706"><span class="linenos">706</span></a>                      <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-707"><a href="#SignalCli.start_receive-707"><span class="linenos">707</span></a>                      <span class="n">all_messages_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-708"><a href="#SignalCli.start_receive-708"><span class="linenos">708</span></a>                      <span class="n">received_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-709"><a href="#SignalCli.start_receive-709"><span class="linenos">709</span></a>                      <span class="n">receipt_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-710"><a href="#SignalCli.start_receive-710"><span class="linenos">710</span></a>                      <span class="n">sync_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-711"><a href="#SignalCli.start_receive-711"><span class="linenos">711</span></a>                      <span class="n">typing_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-712"><a href="#SignalCli.start_receive-712"><span class="linenos">712</span></a>                      <span class="n">story_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-713"><a href="#SignalCli.start_receive-713"><span class="linenos">713</span></a>                      <span class="n">payment_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-714"><a href="#SignalCli.start_receive-714"><span class="linenos">714</span></a>                      <span class="n">reaction_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-715"><a href="#SignalCli.start_receive-715"><span class="linenos">715</span></a>                      <span class="n">call_message_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-716"><a href="#SignalCli.start_receive-716"><span class="linenos">716</span></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SignalCli.start_receive-717"><a href="#SignalCli.start_receive-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.start_receive-718"><a href="#SignalCli.start_receive-718"><span class="linenos">718</span></a><span class="sd">        Start receiving messages for the given account.</span>
</span><span id="SignalCli.start_receive-719"><a href="#SignalCli.start_receive-719"><span class="linenos">719</span></a><span class="sd">        NOTE: Callback signature is (account: Account, message: Message)</span>
</span><span id="SignalCli.start_receive-720"><a href="#SignalCli.start_receive-720"><span class="linenos">720</span></a><span class="sd">        :param account: Account: The account to receive messages for.</span>
</span><span id="SignalCli.start_receive-721"><a href="#SignalCli.start_receive-721"><span class="linenos">721</span></a><span class="sd">        :param all_messages_callback: Optional[Callable]: Callback for all messages received.</span>
</span><span id="SignalCli.start_receive-722"><a href="#SignalCli.start_receive-722"><span class="linenos">722</span></a><span class="sd">        :param received_message_callback: Optional[Callable]: Callback for received messages. (regular message)</span>
</span><span id="SignalCli.start_receive-723"><a href="#SignalCli.start_receive-723"><span class="linenos">723</span></a><span class="sd">        :param receipt_message_callback: Optional[Callable]: Callback for receipt messages.</span>
</span><span id="SignalCli.start_receive-724"><a href="#SignalCli.start_receive-724"><span class="linenos">724</span></a><span class="sd">        :param sync_message_callback: Optional[Callable]: Callback for sync messages.</span>
</span><span id="SignalCli.start_receive-725"><a href="#SignalCli.start_receive-725"><span class="linenos">725</span></a><span class="sd">        :param typing_message_callback: Optional[Callable]: Callback for typing messages.</span>
</span><span id="SignalCli.start_receive-726"><a href="#SignalCli.start_receive-726"><span class="linenos">726</span></a><span class="sd">        :param story_message_callback: Optional[Callable]: Callback for story messages.</span>
</span><span id="SignalCli.start_receive-727"><a href="#SignalCli.start_receive-727"><span class="linenos">727</span></a><span class="sd">        :param payment_message_callback: Optional[Callable]: Callback for payment messages.</span>
</span><span id="SignalCli.start_receive-728"><a href="#SignalCli.start_receive-728"><span class="linenos">728</span></a><span class="sd">        :param reaction_message_callback: Optional[Callable]: Callback for reaction messages.</span>
</span><span id="SignalCli.start_receive-729"><a href="#SignalCli.start_receive-729"><span class="linenos">729</span></a><span class="sd">        :param call_message_callback: Optional[Callable]: Callback for incoming call messages.</span>
</span><span id="SignalCli.start_receive-730"><a href="#SignalCli.start_receive-730"><span class="linenos">730</span></a><span class="sd">        :returns: None</span>
</span><span id="SignalCli.start_receive-731"><a href="#SignalCli.start_receive-731"><span class="linenos">731</span></a><span class="sd">        :raises: TypeError: If the account is not an Account object, or if a callback is defined, but not callable.</span>
</span><span id="SignalCli.start_receive-732"><a href="#SignalCli.start_receive-732"><span class="linenos">732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.start_receive-733"><a href="#SignalCli.start_receive-733"><span class="linenos">733</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-734"><a href="#SignalCli.start_receive-734"><span class="linenos">734</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start receive started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-735"><a href="#SignalCli.start_receive-735"><span class="linenos">735</span></a>        <span class="c1"># Argument checks NOTE: ReceiveThread type checks callbacks:</span>
</span><span id="SignalCli.start_receive-736"><a href="#SignalCli.start_receive-736"><span class="linenos">736</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-737"><a href="#SignalCli.start_receive-737"><span class="linenos">737</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-738"><a href="#SignalCli.start_receive-738"><span class="linenos">738</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-739"><a href="#SignalCli.start_receive-739"><span class="linenos">739</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-740"><a href="#SignalCli.start_receive-740"><span class="linenos">740</span></a>        <span class="k">if</span> <span class="n">all_messages_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">all_messages_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-741"><a href="#SignalCli.start_receive-741"><span class="linenos">741</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-742"><a href="#SignalCli.start_receive-742"><span class="linenos">742</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-743"><a href="#SignalCli.start_receive-743"><span class="linenos">743</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;all_messages_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span> <span class="n">all_messages_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-744"><a href="#SignalCli.start_receive-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="n">received_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">received_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-745"><a href="#SignalCli.start_receive-745"><span class="linenos">745</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-746"><a href="#SignalCli.start_receive-746"><span class="linenos">746</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-747"><a href="#SignalCli.start_receive-747"><span class="linenos">747</span></a>                                             <span class="n">received_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-748"><a href="#SignalCli.start_receive-748"><span class="linenos">748</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;received_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">received_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-749"><a href="#SignalCli.start_receive-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="n">receipt_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">receipt_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-750"><a href="#SignalCli.start_receive-750"><span class="linenos">750</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-751"><a href="#SignalCli.start_receive-751"><span class="linenos">751</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable&#39;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-752"><a href="#SignalCli.start_receive-752"><span class="linenos">752</span></a>                                             <span class="n">receipt_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-753"><a href="#SignalCli.start_receive-753"><span class="linenos">753</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;receipt_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">receipt_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-754"><a href="#SignalCli.start_receive-754"><span class="linenos">754</span></a>        <span class="k">if</span> <span class="n">sync_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">sync_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-755"><a href="#SignalCli.start_receive-755"><span class="linenos">755</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-756"><a href="#SignalCli.start_receive-756"><span class="linenos">756</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-757"><a href="#SignalCli.start_receive-757"><span class="linenos">757</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;sync_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">sync_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-758"><a href="#SignalCli.start_receive-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="n">typing_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">typing_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-759"><a href="#SignalCli.start_receive-759"><span class="linenos">759</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-760"><a href="#SignalCli.start_receive-760"><span class="linenos">760</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-761"><a href="#SignalCli.start_receive-761"><span class="linenos">761</span></a>                                             <span class="n">typing_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-762"><a href="#SignalCli.start_receive-762"><span class="linenos">762</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;typing_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">typing_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-763"><a href="#SignalCli.start_receive-763"><span class="linenos">763</span></a>        <span class="k">if</span> <span class="n">story_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">story_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-764"><a href="#SignalCli.start_receive-764"><span class="linenos">764</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-765"><a href="#SignalCli.start_receive-765"><span class="linenos">765</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s2">&quot;story_message_callback&quot;</span><span class="p">,</span> <span class="s2">&quot;Optional[Callable]&quot;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-766"><a href="#SignalCli.start_receive-766"><span class="linenos">766</span></a>                                             <span class="n">story_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-767"><a href="#SignalCli.start_receive-767"><span class="linenos">767</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;story_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">story_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-768"><a href="#SignalCli.start_receive-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="n">payment_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">payment_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-769"><a href="#SignalCli.start_receive-769"><span class="linenos">769</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-770"><a href="#SignalCli.start_receive-770"><span class="linenos">770</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-771"><a href="#SignalCli.start_receive-771"><span class="linenos">771</span></a>                                             <span class="n">payment_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-772"><a href="#SignalCli.start_receive-772"><span class="linenos">772</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;payment_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">payment_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-773"><a href="#SignalCli.start_receive-773"><span class="linenos">773</span></a>        <span class="k">if</span> <span class="n">reaction_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">reaction_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-774"><a href="#SignalCli.start_receive-774"><span class="linenos">774</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-775"><a href="#SignalCli.start_receive-775"><span class="linenos">775</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-776"><a href="#SignalCli.start_receive-776"><span class="linenos">776</span></a>                                             <span class="n">reaction_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-777"><a href="#SignalCli.start_receive-777"><span class="linenos">777</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s1">&#39;reaction_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">reaction_message_callback</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-778"><a href="#SignalCli.start_receive-778"><span class="linenos">778</span></a>        <span class="k">if</span> <span class="n">call_message_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">call_message_callback</span><span class="p">):</span>
</span><span id="SignalCli.start_receive-779"><a href="#SignalCli.start_receive-779"><span class="linenos">779</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.start_receive-780"><a href="#SignalCli.start_receive-780"><span class="linenos">780</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;call_message_callback&#39;</span><span class="p">,</span> <span class="s1">&#39;Optional[Callable]&#39;</span><span class="p">,</span> <span class="n">call_message_callback</span><span class="p">))</span>
</span><span id="SignalCli.start_receive-781"><a href="#SignalCli.start_receive-781"><span class="linenos">781</span></a>
</span><span id="SignalCli.start_receive-782"><a href="#SignalCli.start_receive-782"><span class="linenos">782</span></a>        <span class="c1"># Start receive:</span>
</span><span id="SignalCli.start_receive-783"><a href="#SignalCli.start_receive-783"><span class="linenos">783</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="SignalCli.start_receive-784"><a href="#SignalCli.start_receive-784"><span class="linenos">784</span></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">ReceiveThread</span><span class="p">(</span><span class="n">server_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-785"><a href="#SignalCli.start_receive-785"><span class="linenos">785</span></a>                               <span class="n">command_socket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_socket</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-786"><a href="#SignalCli.start_receive-786"><span class="linenos">786</span></a>                               <span class="n">config_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-787"><a href="#SignalCli.start_receive-787"><span class="linenos">787</span></a>                               <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-788"><a href="#SignalCli.start_receive-788"><span class="linenos">788</span></a>                               <span class="n">sticker_packs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sticker_packs</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-789"><a href="#SignalCli.start_receive-789"><span class="linenos">789</span></a>                               <span class="n">all_messages_callback</span><span class="o">=</span><span class="n">all_messages_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-790"><a href="#SignalCli.start_receive-790"><span class="linenos">790</span></a>                               <span class="n">received_message_callback</span><span class="o">=</span><span class="n">received_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-791"><a href="#SignalCli.start_receive-791"><span class="linenos">791</span></a>                               <span class="n">receipt_message_callback</span><span class="o">=</span><span class="n">receipt_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-792"><a href="#SignalCli.start_receive-792"><span class="linenos">792</span></a>                               <span class="n">sync_message_callback</span><span class="o">=</span><span class="n">sync_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-793"><a href="#SignalCli.start_receive-793"><span class="linenos">793</span></a>                               <span class="n">typing_message_callback</span><span class="o">=</span><span class="n">typing_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-794"><a href="#SignalCli.start_receive-794"><span class="linenos">794</span></a>                               <span class="n">story_message_callback</span><span class="o">=</span><span class="n">story_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-795"><a href="#SignalCli.start_receive-795"><span class="linenos">795</span></a>                               <span class="n">payment_message_callback</span><span class="o">=</span><span class="n">payment_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-796"><a href="#SignalCli.start_receive-796"><span class="linenos">796</span></a>                               <span class="n">reaction_message_callback</span><span class="o">=</span><span class="n">reaction_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-797"><a href="#SignalCli.start_receive-797"><span class="linenos">797</span></a>                               <span class="n">call_message_callback</span><span class="o">=</span><span class="n">call_message_callback</span><span class="p">,</span>
</span><span id="SignalCli.start_receive-798"><a href="#SignalCli.start_receive-798"><span class="linenos">798</span></a>                               <span class="p">)</span>
</span><span id="SignalCli.start_receive-799"><a href="#SignalCli.start_receive-799"><span class="linenos">799</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="SignalCli.start_receive-800"><a href="#SignalCli.start_receive-800"><span class="linenos">800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thread</span>
</span><span id="SignalCli.start_receive-801"><a href="#SignalCli.start_receive-801"><span class="linenos">801</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Start receiving messages for the given account.
NOTE: Callback signature is (account: Account, message: Message)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>account: Account</strong>:  The account to receive messages for.</li>
<li><strong>all_messages_callback: Optional[Callable]</strong>:  Callback for all messages received.</li>
<li><strong>received_message_callback: Optional[Callable]</strong>:  Callback for received messages. (regular message)</li>
<li><strong>receipt_message_callback: Optional[Callable]</strong>:  Callback for receipt messages.</li>
<li><strong>sync_message_callback: Optional[Callable]</strong>:  Callback for sync messages.</li>
<li><strong>typing_message_callback: Optional[Callable]</strong>:  Callback for typing messages.</li>
<li><strong>story_message_callback: Optional[Callable]</strong>:  Callback for story messages.</li>
<li><strong>payment_message_callback: Optional[Callable]</strong>:  Callback for payment messages.</li>
<li><strong>reaction_message_callback: Optional[Callable]</strong>:  Callback for reaction messages.</li>
<li><strong>call_message_callback: Optional[Callable]</strong>:  Callback for incoming call messages.
:returns: None</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li>TypeError: If the account is not an Account object, or if a callback is defined, but not callable.</li>
</ul>
</div>


                            </div>
                            <div id="SignalCli.stop_receive" class="classattr">
                                        <input id="SignalCli.stop_receive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_receive</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="n"><a href="signalAccount.html#Account">SignalCliApi.signalAccount.Account</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="SignalCli.stop_receive-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SignalCli.stop_receive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SignalCli.stop_receive-803"><a href="#SignalCli.stop_receive-803"><span class="linenos">803</span></a>    <span class="k">def</span> <span class="nf">stop_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="n">Account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SignalCli.stop_receive-804"><a href="#SignalCli.stop_receive-804"><span class="linenos">804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SignalCli.stop_receive-805"><a href="#SignalCli.stop_receive-805"><span class="linenos">805</span></a><span class="sd">        Stop receiving messages for the given account.</span>
</span><span id="SignalCli.stop_receive-806"><a href="#SignalCli.stop_receive-806"><span class="linenos">806</span></a><span class="sd">        :param account: Account: The account to stop reception for.</span>
</span><span id="SignalCli.stop_receive-807"><a href="#SignalCli.stop_receive-807"><span class="linenos">807</span></a><span class="sd">        :returns: bool: True reception successfully stopped, False reception wasn&#39;t started.</span>
</span><span id="SignalCli.stop_receive-808"><a href="#SignalCli.stop_receive-808"><span class="linenos">808</span></a><span class="sd">        :raises: TypeError: If the parameter account is not an Account object.</span>
</span><span id="SignalCli.stop_receive-809"><a href="#SignalCli.stop_receive-809"><span class="linenos">809</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SignalCli.stop_receive-810"><a href="#SignalCli.stop_receive-810"><span class="linenos">810</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_receive</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-811"><a href="#SignalCli.stop_receive-811"><span class="linenos">811</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping reception thread.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-812"><a href="#SignalCli.stop_receive-812"><span class="linenos">812</span></a>        <span class="c1"># Argument checks:</span>
</span><span id="SignalCli.stop_receive-813"><a href="#SignalCli.stop_receive-813"><span class="linenos">813</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
</span><span id="SignalCli.stop_receive-814"><a href="#SignalCli.stop_receive-814"><span class="linenos">814</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Raising TypeError:&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-815"><a href="#SignalCli.stop_receive-815"><span class="linenos">815</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">__type_err_msg__</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">))</span>
</span><span id="SignalCli.stop_receive-816"><a href="#SignalCli.stop_receive-816"><span class="linenos">816</span></a>            <span class="n">__type_error__</span><span class="p">(</span><span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;Account&quot;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-817"><a href="#SignalCli.stop_receive-817"><span class="linenos">817</span></a>        <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">number</span>
</span><span id="SignalCli.stop_receive-818"><a href="#SignalCli.stop_receive-818"><span class="linenos">818</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SignalCli.stop_receive-819"><a href="#SignalCli.stop_receive-819"><span class="linenos">819</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching thread: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">thread_id</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-820"><a href="#SignalCli.stop_receive-820"><span class="linenos">820</span></a>            <span class="n">thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span>
</span><span id="SignalCli.stop_receive-821"><a href="#SignalCli.stop_receive-821"><span class="linenos">821</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SignalCli.stop_receive-822"><a href="#SignalCli.stop_receive-822"><span class="linenos">822</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread not started.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-823"><a href="#SignalCli.stop_receive-823"><span class="linenos">823</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SignalCli.stop_receive-824"><a href="#SignalCli.stop_receive-824"><span class="linenos">824</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Stopping thread...&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-825"><a href="#SignalCli.stop_receive-825"><span class="linenos">825</span></a>        <span class="n">thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="SignalCli.stop_receive-826"><a href="#SignalCli.stop_receive-826"><span class="linenos">826</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thread stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-827"><a href="#SignalCli.stop_receive-827"><span class="linenos">827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_threads</span><span class="p">[</span><span class="n">thread_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SignalCli.stop_receive-828"><a href="#SignalCli.stop_receive-828"><span class="linenos">828</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reception stopped.&quot;</span><span class="p">)</span>
</span><span id="SignalCli.stop_receive-829"><a href="#SignalCli.stop_receive-829"><span class="linenos">829</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Stop receiving messages for the given account.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>account: Account</strong>:  The account to stop reception for.
:returns: bool: True reception successfully stopped, False reception wasn't started.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li>TypeError: If the parameter account is not an Account object.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>